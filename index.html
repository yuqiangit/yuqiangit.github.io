<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="五年" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="技术博客">
<meta property="og:type" content="website">
<meta property="og:title" content="五年">
<meta property="og:url" content="https://yuqiangit.github.io/index.html">
<meta property="og:site_name" content="五年">
<meta property="og:description" content="技术博客">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="五年">
<meta name="twitter:description" content="技术博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://yuqiangit.github.io/"/>





  <title>五年</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">五年</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">一身转战三千里 一剑曾当百万师</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://yuqiangit.github.io/2017/05/12/session/cookie禁用掉之后/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="walter">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="五年">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/12/session/cookie禁用掉之后/" itemprop="url">session解析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-12T17:20:44+08:00">
                2017-05-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#session解析</p>
<p>##http<br>Http是一种无状态性的协议。这是因为此种协议不要求浏览器在每次请求中标明它自己的身份，并且浏览器以及服务器之间并没有保持一个持久性的连接用于多个页面之间的访问。当一个用户访问一个站点的时候，用户的浏览器发送一个http请求到服务器，服务器返回给浏览器一个http响应。其实很简单的一个概念，客户端一个请求，服务器端一个回复，这就是整个基于http协议的通讯过程。</p>
<p>##cookie<br>Cookie（复数形态Cookies），中文名称为“小型文本文件”或“小甜饼”[1]，指某些网站为了辨别用户身份而储存在用户本地终端（Client Side）上的数据（通常经过加密）。定义于RFC2109。是网景公司的前雇员卢·蒙特利在1993年3月的发明[2]。</p>
<p>浏览器中cookie<br><img src="http://playback-langlive.ufile.ucloud.com.cn/5774d0b52c10c3fa9a6bfa85a8757ef7" alt="Alt text"></p>
<p>##禁用cookie之后</p>
<p>当禁用cookie之后，浏览器进行网页的访问，cookie就不存在了，自然不能将session_id传入到服务端，服务端也就无法识别用户的身份。</p>
<p>这里面的核心问题其实跟cookie没关系，仅仅是session_id（用户身份标识）无法传输到服务端了。</p>
<p>那我们把session_id作为一个参数来看待，解决的问题的方案就出来了，手动的传输我们session_id到服务端就好了。</p>
<p>这就是url重写。不管是get 还是post 请求，根据业务相应的传输方案就好。</p>
<p>当前端里面的session_id，通过请求发送到服务器之后，php服务端处理方案是：</p>
<ol>
<li>获取客户端传入的session_id,</li>
<li>设置session_id </li>
<li>即可正常的读取session内容</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line"></div><div class="line">session_start();</div><div class="line">session_id(<span class="string">'020e163uku6ptt7cm6eoj50992'</span>);</div><div class="line">var_dump(<span class="variable">$_SESSION</span>);</div><div class="line"><span class="keyword">if</span> (empty(<span class="variable">$_SESSION</span>[<span class="string">'count'</span>])) &#123;</div><div class="line">    <span class="variable">$_SESSION</span>[<span class="string">'count'</span>] = 1;</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="variable">$_SESSION</span>[<span class="string">'count'</span>]++;</div><div class="line">&#125;</div><div class="line">?&gt;</div><div class="line"></div><div class="line">&lt;p&gt;</div><div class="line">    Hello visitor, you have seen this page &lt;?php <span class="built_in">echo</span> <span class="variable">$_SESSION</span>[<span class="string">'count'</span>].htmlspecialchars(SID); ?&gt; times.</div><div class="line">&lt;/p&gt;</div><div class="line"></div><div class="line">&lt;p&gt;</div><div class="line">    To <span class="built_in">continue</span>, &lt;a href=<span class="string">"&lt;?php echo "</span>nextpage.php?<span class="string">". htmlspecialchars(SID); ?&gt;"</span>&gt;click here&lt;/a&gt;.</div><div class="line">&lt;/p&gt;</div></pre></td></tr></table></figure>
<p><em>上述代码</em></p>
<blockquote>
<p>SID的session_id，在cookie被禁用的模式下，会自动被赋值<br>session_id($sid)，通过手动设置session_id 既可以实现session的状态</p>
</blockquote>
<p>##php 中的 session</p>
<p>php中session的位置可以进行配置：<br>session.save_path = “/tmp/session”</p>
<p>我使用的服务器，默认在/tmp里面<br>session在服务器上的实际存在情况<br>|字段|值|<br>|-:-|<br>|path |<code>/tmp/sess_ucqqv1ej1lulttmste47hpuj56</code>|<br>|info|<code>$key\|type:len:&quot;$value&quot;\</code></p>
<p>参考文档：</p>
<p><a href="http://www.jianshu.com/p/2b7c10291aad" target="_blank" rel="external">SESSION 原理</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://yuqiangit.github.io/2017/05/05/redis/redis集群/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="walter">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="五年">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/05/redis/redis集群/" itemprop="url">redis集群</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-05T18:20:44+08:00">
                2017-05-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="redis"><a href="#redis" class="headerlink" title="#redis"></a>#redis</h2><p>[toc]</p>
<p>##1. 基础配置参数</p>
<p>redis基础配置</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>配置</th>
<th>eg</th>
</tr>
</thead>
<tbody>
<tr>
<td>prot</td>
<td>端口</td>
<td><code>7379</code></td>
</tr>
<tr>
<td>daemonize</td>
<td>yes</td>
<td>后台执行</td>
</tr>
<tr>
<td>cluster-enabled</td>
<td>yes</td>
<td>开启集群</td>
</tr>
<tr>
<td>cluster-config-file</td>
<td>nodes.conf</td>
<td>集群配置文件，自动生成</td>
</tr>
<tr>
<td>cluster-node-timeout</td>
<td>5000</td>
<td>集群中节点状态检查超时时间，超过界限会被标记为失败，并通过选举算法，关闭节点</td>
</tr>
<tr>
<td>cluster-slave-validity-factor <factor></factor></td>
<td>尝试主从切换的时间 为0时始终常识进行主从切换 ；请注意，任何不同于零的值都可能导致如果没有从站能够故障转移，则主站故障后Redis Cluster将不可用</td>
</tr>
<tr>
<td>logfile</td>
<td>“redis.log”</td>
<td>log文件配置</td>
</tr>
<tr>
<td>cluster-migration-barrier <count></count></td>
<td><code>?</code></td>
</tr>
<tr>
<td>cluster-require-full-coverage <yes no=""></yes></td>
<td><code>集群空间全覆盖检查?</code></td>
<td>如果这设置为是，默认情况下，如果某个百分比的密钥空间未被任何节点覆盖，则群集将停止接受写入，如果选项设置为否，则集群仍将提供查询，即使仅可以处理关于键子集的请求。</td>
</tr>
<tr>
<td>dbfilename</td>
<td>save db on disk</td>
<td><code>dbfilename 7379.rdb</code> 最快1分钟备份一次 默认的备份方式</td>
</tr>
<tr>
<td>appendonly</td>
<td>yes</td>
<td>aof持久化开启，有较大的io压力，谨慎开启</td>
</tr>
<tr>
<td>appendfilename</td>
<td>save cmd</td>
<td><code>7379.appendonly.aof</code> 每条命令执行进行备份；io压力</td>
</tr>
<tr>
<td>appendfsync</td>
<td>always everysec no</td>
<td>递减</td>
</tr>
</tbody>
</table>
<hr>
<p>##2. 高可用</p>
<p>###架构目标 Cluster + (master &amp; slaves)<br>可选方案</p>
<ol>
<li>redis集群</li>
<li>主从</li>
<li>sentinel 2</li>
</ol>
<p>###集群数据一致性保障</p>
<ol>
<li>异步操作，不能保证强一致性。</li>
<li>节点超时</li>
</ol>
<p>##3. 集群创建的流程</p>
<p>请以官方文档为主：<a href="https://redis.io/topics/cluster-tutorial" target="_blank" rel="external">https://redis.io/topics/cluster-tutorial</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line">**	redis.conf文件</div><div class="line">port 7000</div><div class="line">daemonize yes</div><div class="line">cluster-enabled yes</div><div class="line">cluster-config-file nodes.conf</div><div class="line">cluster-node-timeout 5000</div><div class="line">appendonly yes</div><div class="line">logfile <span class="string">"redis.log"</span></div><div class="line"></div><div class="line">** 启动集群 输出</div><div class="line">vagrant@vagrant-ubuntu-trusty-64:~$ /data/<span class="built_in">local</span>/redis/redis-3.2.8/src/redis-trib.rb create --replicas 1 127.0.0.1:7000 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005</div><div class="line">&gt;&gt;&gt; Creating cluster</div><div class="line">&gt;&gt;&gt; Performing <span class="built_in">hash</span> slots allocation on 6 nodes...</div><div class="line">Using 3 masters:</div><div class="line">127.0.0.1:7000</div><div class="line">127.0.0.1:7001</div><div class="line">127.0.0.1:7002</div><div class="line">Adding replica 127.0.0.1:7003 to 127.0.0.1:7000</div><div class="line">Adding replica 127.0.0.1:7004 to 127.0.0.1:7001</div><div class="line">Adding replica 127.0.0.1:7005 to 127.0.0.1:7002</div><div class="line">M: fb165309530288508d643b45381c114ac23246e7 127.0.0.1:7000</div><div class="line">   slots:0-5460 (5461 slots) master</div><div class="line">M: 849c0c5c3401<span class="built_in">cd</span>429cfc12943773c8c5c3878b63 127.0.0.1:7001</div><div class="line">   slots:5461-10922 (5462 slots) master</div><div class="line">M: a9be2c77dd3c67728315eba597dd13ce5ecd7523 127.0.0.1:7002</div><div class="line">   slots:10923-16383 (5461 slots) master</div><div class="line">S: e8addb041027ab38ef58a1e2a5cfa920ff188fca 127.0.0.1:7003</div><div class="line">   replicates fb165309530288508d643b45381c114ac23246e7</div><div class="line">S: b5d559e19d2a539b16d5b0cb05743a24865854cf 127.0.0.1:7004</div><div class="line">   replicates 849c0c5c3401<span class="built_in">cd</span>429cfc12943773c8c5c3878b63</div><div class="line">S: 97364828304bcff993cddd696c631f79eeaad7f1 127.0.0.1:7005</div><div class="line">   replicates a9be2c77dd3c67728315eba597dd13ce5ecd7523</div><div class="line">Can I <span class="built_in">set</span> the above configuration? (<span class="built_in">type</span> <span class="string">'yes'</span> to accept): yes</div><div class="line">&gt;&gt;&gt; Nodes configuration updated</div><div class="line">&gt;&gt;&gt; Assign a different config epoch to each node</div><div class="line">&gt;&gt;&gt; Sending CLUSTER MEET messages to join the cluster</div><div class="line">Waiting <span class="keyword">for</span> the cluster to join...</div><div class="line">&gt;&gt;&gt; Performing Cluster Check (using node 127.0.0.1:7000)</div><div class="line">M: fb165309530288508d643b45381c114ac23246e7 127.0.0.1:7000</div><div class="line">   slots:0-5460 (5461 slots) master</div><div class="line">   1 additional replica(s)</div><div class="line">S: b5d559e19d2a539b16d5b0cb05743a24865854cf 127.0.0.1:7004</div><div class="line">   slots: (0 slots) slave</div><div class="line">   replicates 849c0c5c3401<span class="built_in">cd</span>429cfc12943773c8c5c3878b63</div><div class="line">S: 97364828304bcff993cddd696c631f79eeaad7f1 127.0.0.1:7005</div><div class="line">   slots: (0 slots) slave</div><div class="line">   replicates a9be2c77dd3c67728315eba597dd13ce5ecd7523</div><div class="line">M: 849c0c5c3401<span class="built_in">cd</span>429cfc12943773c8c5c3878b63 127.0.0.1:7001</div><div class="line">   slots:5461-10922 (5462 slots) master</div><div class="line">   1 additional replica(s)</div><div class="line">S: e8addb041027ab38ef58a1e2a5cfa920ff188fca 127.0.0.1:7003</div><div class="line">   slots: (0 slots) slave</div><div class="line">   replicates fb165309530288508d643b45381c114ac23246e7</div><div class="line">M: a9be2c77dd3c67728315eba597dd13ce5ecd7523 127.0.0.1:7002</div><div class="line">   slots:10923-16383 (5461 slots) master</div><div class="line">   1 additional replica(s)</div><div class="line">[OK] All nodes agree about slots configuration.</div><div class="line">&gt;&gt;&gt; Check <span class="keyword">for</span> open slots...</div><div class="line">&gt;&gt;&gt; Check slots coverage...</div><div class="line">[OK] All 16384 slots covered.</div></pre></td></tr></table></figure>
<p><code>节点id创建的时候确定。不随着ip port 改变；</code></p>
<p>###集群中客户端 输出<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">14079:M 04 May 07:44:31.314 <span class="comment"># Server started, Redis version 3.2.8</span></div><div class="line">14079:M 04 May 07:44:31.315 * The server is now ready to accept connections on port 7000</div><div class="line">14079:M 04 May 07:52:02.099 <span class="comment"># configEpoch set to 1 via CLUSTER SET-CONFIG-EPOCH</span></div><div class="line">14079:M 04 May 07:52:02.119 <span class="comment"># IP address for this node updated to 127.0.0.1</span></div><div class="line">14079:M 04 May 07:52:06.529 * Slave 127.0.0.1:7003 asks <span class="keyword">for</span> synchronization</div><div class="line">14079:M 04 May 07:52:06.529 * Full resync requested by slave 127.0.0.1:7003</div><div class="line">14079:M 04 May 07:52:06.529 * Starting BGSAVE <span class="keyword">for</span> SYNC with target: disk</div><div class="line">14079:M 04 May 07:52:06.529 * Background saving started by pid 14677</div><div class="line">14677:C 04 May 07:52:06.531 * DB saved on disk</div><div class="line">14677:C 04 May 07:52:06.532 * RDB: 0 MB of memory used by copy-on-write</div><div class="line">14079:M 04 May 07:52:06.626 * Background saving terminated with success</div><div class="line">14079:M 04 May 07:52:06.628 * Synchronization with slave 127.0.0.1:7003 succeeded</div><div class="line">14079:M 04 May 07:52:07.032 <span class="comment"># Cluster state changed: ok</span></div></pre></td></tr></table></figure></p>
<p>###数据重塑-分配插槽 Resharding the cluster</p>
<blockquote>
<p>所有的重塑抽取的都是从节点的前面slot开始抽取。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">开始重新塑造</div><div class="line">/data/<span class="built_in">local</span>/redis/redis-3.2.8/src/redis-trib.rb reshard 127.0.0.1:7000 </div><div class="line"></div><div class="line">检查塑造结果</div><div class="line">/data/<span class="built_in">local</span>/redis/redis-3.2.8/src/redis-trib.rb check 127.0.0.1:7000 </div><div class="line"></div><div class="line">查看自己的节点</div><div class="line">redis-cli -p 7000 cluster nodes | grep myself</div></pre></td></tr></table></figure>
<p>###数据重塑-分配插槽 Scripting a resharding operation<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">./redis-trib.rb reshard --from &lt;node-id&gt; --to &lt;node-id&gt; --slots &lt;number of slots&gt; --yes &lt;host&gt;:&lt;port&gt;</div><div class="line"></div><div class="line">eg</div><div class="line">./redis-trib.rb reshard --from fb165309530288508d643b45381c114ac23246e7 --to 849c0c5c3401<span class="built_in">cd</span>429cfc12943773c8c5c3878b63 --slots 500 --yes 127.0.0.1:7000</div></pre></td></tr></table></figure></p>
<p>####集群重塑源文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">vagrant@vagrant-ubuntu-trusty-64:~$ /data/<span class="built_in">local</span>/redis/redis-3.2.8/src/redis-trib.rb reshard 127.0.0.1:7000</div><div class="line">&gt;&gt;&gt; Performing Cluster Check (using node 127.0.0.1:7000)</div><div class="line">M: fb165309530288508d643b45381c114ac23246e7 127.0.0.1:7000</div><div class="line">   slots:0-5460 (5461 slots) master</div><div class="line">   1 additional replica(s)</div><div class="line">S: b5d559e19d2a539b16d5b0cb05743a24865854cf 127.0.0.1:7004</div><div class="line">   slots: (0 slots) slave</div><div class="line">   replicates 849c0c5c3401<span class="built_in">cd</span>429cfc12943773c8c5c3878b63</div><div class="line">S: 97364828304bcff993cddd696c631f79eeaad7f1 127.0.0.1:7005</div><div class="line">   slots: (0 slots) slave</div><div class="line">   replicates a9be2c77dd3c67728315eba597dd13ce5ecd7523</div><div class="line">M: 849c0c5c3401<span class="built_in">cd</span>429cfc12943773c8c5c3878b63 127.0.0.1:7001</div><div class="line">   slots:5461-10922 (5462 slots) master</div><div class="line">   1 additional replica(s)</div><div class="line">S: e8addb041027ab38ef58a1e2a5cfa920ff188fca 127.0.0.1:7003</div><div class="line">   slots: (0 slots) slave</div><div class="line">   replicates fb165309530288508d643b45381c114ac23246e7</div><div class="line">M: a9be2c77dd3c67728315eba597dd13ce5ecd7523 127.0.0.1:7002</div><div class="line">   slots:10923-16383 (5461 slots) master</div><div class="line">   1 additional replica(s)</div><div class="line">[OK] All nodes agree about slots configuration.</div><div class="line">&gt;&gt;&gt; Check <span class="keyword">for</span> open slots...</div><div class="line">&gt;&gt;&gt; Check slots coverage...</div><div class="line">[OK] All 16384 slots covered.</div><div class="line">How many slots <span class="keyword">do</span> you want to move (from 1 to 16384)? 1000</div><div class="line">What is the receiving node ID? fb165309530288508d643b45381c114ac23246e7</div><div class="line">Please enter all the <span class="built_in">source</span> node IDs.</div><div class="line">  Type <span class="string">'all'</span> to use all the nodes as <span class="built_in">source</span> nodes <span class="keyword">for</span> the <span class="built_in">hash</span> slots.</div><div class="line">  Type <span class="string">'done'</span> once you entered all the <span class="built_in">source</span> nodes IDs.</div><div class="line">Source node <span class="comment">#1:all</span></div><div class="line"></div><div class="line">分别从其它节点中取得所需的slots</div><div class="line"></div><div class="line">Ready to move 1000 slots.</div><div class="line">  Source nodes:</div><div class="line">    M: 849c0c5c3401<span class="built_in">cd</span>429cfc12943773c8c5c3878b63 127.0.0.1:7001</div><div class="line">   slots:5461-10922 (5462 slots) master</div><div class="line">   1 additional replica(s)</div><div class="line">    M: a9be2c77dd3c67728315eba597dd13ce5ecd7523 127.0.0.1:7002</div><div class="line">   slots:10923-16383 (5461 slots) master</div><div class="line">   1 additional replica(s)</div><div class="line">  Destination node:</div><div class="line">    M: fb165309530288508d643b45381c114ac23246e7 127.0.0.1:7000</div><div class="line">   slots:0-5460 (5461 slots) master</div><div class="line">   1 additional replica(s)</div><div class="line">  Resharding plan:</div><div class="line">    Moving slot 5461 from 849c0c5c3401<span class="built_in">cd</span>429cfc12943773c8c5c3878b63</div><div class="line">    Moving slot 5462 from 849c0c5c3401<span class="built_in">cd</span>429cfc12943773c8c5c3878b63</div></pre></td></tr></table></figure></p>
<p>###故障转移</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">查看所有的主节点</div><div class="line"> redis-cli -p 7000 cluster nodes | grep master</div><div class="line"></div><div class="line">主动出发销毁</div><div class="line"> redis-cli -p 7002 debug segfault</div><div class="line"></div><div class="line">查看销毁后的节点情况</div><div class="line">redis-cli -p 7000 cluster nodes</div><div class="line"></div><div class="line">集群节点信息</div><div class="line">The output of the CLUSTER NODES <span class="built_in">command</span> may look intimidating, but it is actually pretty simple, and is composed of the following tokens:</div><div class="line">Node ID</div><div class="line">ip:port</div><div class="line">flags: master, slave, myself, fail, ...</div><div class="line"><span class="keyword">if</span> it is a slave, the Node ID of the master</div><div class="line">Time of the last pending PING still waiting <span class="keyword">for</span> a reply.</div><div class="line">Time of the last PONG received.</div><div class="line">Configuration epoch <span class="keyword">for</span> this node (see the Cluster specification). 节点的配置时期？</div><div class="line">Status of the link to this node. 指向此节点的连接状态</div><div class="line">Slots served... 插槽分配</div></pre></td></tr></table></figure>
<p>###故障转移（Manual failover）</p>
<blockquote>
<p>Manual failovers are supported by Redis Cluster using the CLUSTER FAILOVER command, that must be executed in one of the slaves of the master you want to failover.<br>手动故障转移再升级系统时非常有效。必须在预进行故障转移的从库中进行。</p>
</blockquote>
<p>####log文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Manual failover user request accepted.</span></div><div class="line"><span class="comment"># Received replication offset for paused master manual failover: 347540</span></div><div class="line"><span class="comment"># All master replication stream processed, manual failover can start.</span></div><div class="line"><span class="comment"># Start of election delayed for 0 milliseconds (rank #0, offset 347540).</span></div><div class="line"><span class="comment"># Starting a failover election for epoch 7545.</span></div><div class="line"><span class="comment"># Failover election won: I'm the new master.</span></div></pre></td></tr></table></figure></p>
<p>###添加新的节点Adding a new node<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">随机添加（添加7006端口的机器，到7000集群中，默认添加的会是主库）</div><div class="line">/data/local/redis/redis-3.2.8/src/redis-trib.rb add-node 127.0.0.1:7006 127.0.0.1:7000</div><div class="line"></div><div class="line"></div><div class="line">指定添加</div><div class="line">/data/local/redis/redis-3.2.8/src/redis-trib.rb add-node --slave --master-id 3c3a0c74aae0b56170ccb03a76b60cfe7dc1912e 127.0.0.1:7006 127.0.0.1:7000</div></pre></td></tr></table></figure></p>
<p>####源文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">vagrant@vagrant-ubuntu-trusty-64:~$ /data/<span class="built_in">local</span>/redis/redis-3.2.8/src/redis-trib.rb add-node 127.0.0.1:7006 127.0.0.1:7000</div><div class="line">&gt;&gt;&gt; Adding node 127.0.0.1:7006 to cluster 127.0.0.1:7000</div><div class="line">&gt;&gt;&gt; Performing Cluster Check (using node 127.0.0.1:7000)</div><div class="line">M: fb165309530288508d643b45381c114ac23246e7 127.0.0.1:7000</div><div class="line">   slots:500-5961,10923-11421 (5961 slots) master</div><div class="line">   1 additional replica(s)</div><div class="line">S: b5d559e19d2a539b16d5b0cb05743a24865854cf 127.0.0.1:7004</div><div class="line">   slots: (0 slots) slave</div><div class="line">   replicates 849c0c5c3401<span class="built_in">cd</span>429cfc12943773c8c5c3878b63</div><div class="line">M: 97364828304bcff993cddd696c631f79eeaad7f1 127.0.0.1:7005</div><div class="line">   slots:11422-16383 (4962 slots) master</div><div class="line">   0 additional replica(s)</div><div class="line">M: 849c0c5c3401<span class="built_in">cd</span>429cfc12943773c8c5c3878b63 127.0.0.1:7001</div><div class="line">   slots:0-499,5962-10922 (5461 slots) master</div><div class="line">   1 additional replica(s)</div><div class="line">S: e8addb041027ab38ef58a1e2a5cfa920ff188fca 127.0.0.1:7003</div><div class="line">   slots: (0 slots) slave</div><div class="line">   replicates fb165309530288508d643b45381c114ac23246e7</div><div class="line">[OK] All nodes agree about slots configuration.</div><div class="line">&gt;&gt;&gt; Check <span class="keyword">for</span> open slots...</div><div class="line">&gt;&gt;&gt; Check slots coverage...</div><div class="line">[OK] All 16384 slots covered.</div><div class="line">&gt;&gt;&gt; Send CLUSTER MEET to node 127.0.0.1:7006 to make it join the cluster.</div><div class="line">[OK] New node added correctly.</div></pre></td></tr></table></figure></p>
<p>####手动添加的状态<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">vagrant@vagrant-ubuntu-trusty-64:~$ redis-cli -c -p 7006</div><div class="line">127.0.0.1:7006&gt;  cluster nodes</div><div class="line">b322c8631fe98c26e7e26b5<span class="built_in">cd</span>8f8d1e3b32da16b 127.0.0.1:7006 myself,master - 0 0 0 connected</div></pre></td></tr></table></figure></p>
<p>###为集群自动添加从库 Adding a new node as a replica<br><code>cluster replicate 3c3a0c74aae0b56170ccb03a76b60cfe7dc1912e</code></p>
<p>###删除节点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">redis-trib del-node 127.0.0.1:7000 b322c8631fe98c26e7e26b5<span class="built_in">cd</span>8f8d1e3b32da16b</div></pre></td></tr></table></figure>
<p><code>如果需要删除的节点重新作为从库加入到集群中，需要删除node    rm -rf nodes.conf</code><br><code>删除主节点时，需要讲主节点的数据清空：参考手动故障转移</code></p>
<p>###副本迁移 Replicas migration<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">CLUSTER REPLICATE &lt;master-node-id&gt;</div></pre></td></tr></table></figure></p>
<p><code>死掉的主库，在被重新拉起之后，自动顶替它的主库的从库</code></p>
<p>##redis配置文件 完整参考<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div><div class="line">554</div><div class="line">555</div><div class="line">556</div><div class="line">557</div><div class="line">558</div><div class="line">559</div><div class="line">560</div><div class="line">561</div><div class="line">562</div><div class="line">563</div><div class="line">564</div><div class="line">565</div><div class="line">566</div><div class="line">567</div><div class="line">568</div><div class="line">569</div><div class="line">570</div><div class="line">571</div><div class="line">572</div><div class="line">573</div><div class="line">574</div><div class="line">575</div><div class="line">576</div><div class="line">577</div><div class="line">578</div><div class="line">579</div><div class="line">580</div><div class="line">581</div><div class="line">582</div><div class="line">583</div><div class="line">584</div><div class="line">585</div><div class="line">586</div><div class="line">587</div><div class="line">588</div><div class="line">589</div><div class="line">590</div><div class="line">591</div><div class="line">592</div><div class="line">593</div><div class="line">594</div><div class="line">595</div><div class="line">596</div><div class="line">597</div><div class="line">598</div><div class="line">599</div><div class="line">600</div><div class="line">601</div><div class="line">602</div><div class="line">603</div><div class="line">604</div><div class="line">605</div><div class="line">606</div><div class="line">607</div><div class="line">608</div><div class="line">609</div><div class="line">610</div><div class="line">611</div><div class="line">612</div><div class="line">613</div><div class="line">614</div><div class="line">615</div><div class="line">616</div><div class="line">617</div><div class="line">618</div><div class="line">619</div><div class="line">620</div><div class="line">621</div><div class="line">622</div><div class="line">623</div><div class="line">624</div><div class="line">625</div><div class="line">626</div><div class="line">627</div><div class="line">628</div><div class="line">629</div><div class="line">630</div><div class="line">631</div><div class="line">632</div><div class="line">633</div><div class="line">634</div><div class="line">635</div><div class="line">636</div><div class="line">637</div><div class="line">638</div><div class="line">639</div><div class="line">640</div><div class="line">641</div><div class="line">642</div><div class="line">643</div><div class="line">644</div><div class="line">645</div><div class="line">646</div><div class="line">647</div><div class="line">648</div><div class="line">649</div><div class="line">650</div><div class="line">651</div><div class="line">652</div><div class="line">653</div><div class="line">654</div><div class="line">655</div><div class="line">656</div><div class="line">657</div><div class="line">658</div><div class="line">659</div><div class="line">660</div><div class="line">661</div><div class="line">662</div><div class="line">663</div><div class="line">664</div><div class="line">665</div><div class="line">666</div><div class="line">667</div><div class="line">668</div><div class="line">669</div><div class="line">670</div><div class="line">671</div><div class="line">672</div><div class="line">673</div><div class="line">674</div><div class="line">675</div><div class="line">676</div><div class="line">677</div><div class="line">678</div><div class="line">679</div><div class="line">680</div><div class="line">681</div><div class="line">682</div><div class="line">683</div><div class="line">684</div><div class="line">685</div><div class="line">686</div><div class="line">687</div><div class="line">688</div><div class="line">689</div><div class="line">690</div><div class="line">691</div><div class="line">692</div><div class="line">693</div><div class="line">694</div><div class="line">695</div><div class="line">696</div><div class="line">697</div><div class="line">698</div><div class="line">699</div><div class="line">700</div><div class="line">701</div><div class="line">702</div><div class="line">703</div><div class="line">704</div><div class="line">705</div><div class="line">706</div><div class="line">707</div><div class="line">708</div><div class="line">709</div><div class="line">710</div><div class="line">711</div><div class="line">712</div><div class="line">713</div><div class="line">714</div><div class="line">715</div><div class="line">716</div><div class="line">717</div><div class="line">718</div><div class="line">719</div><div class="line">720</div><div class="line">721</div><div class="line">722</div><div class="line">723</div><div class="line">724</div><div class="line">725</div><div class="line">726</div><div class="line">727</div><div class="line">728</div><div class="line">729</div><div class="line">730</div><div class="line">731</div><div class="line">732</div><div class="line">733</div><div class="line">734</div><div class="line">735</div><div class="line">736</div><div class="line">737</div><div class="line">738</div><div class="line">739</div><div class="line">740</div><div class="line">741</div><div class="line">742</div><div class="line">743</div><div class="line">744</div><div class="line">745</div><div class="line">746</div><div class="line">747</div><div class="line">748</div><div class="line">749</div><div class="line">750</div><div class="line">751</div><div class="line">752</div><div class="line">753</div><div class="line">754</div><div class="line">755</div><div class="line">756</div><div class="line">757</div><div class="line">758</div><div class="line">759</div><div class="line">760</div><div class="line">761</div><div class="line">762</div><div class="line">763</div><div class="line">764</div><div class="line">765</div><div class="line">766</div><div class="line">767</div><div class="line">768</div><div class="line">769</div><div class="line">770</div><div class="line">771</div><div class="line">772</div><div class="line">773</div><div class="line">774</div><div class="line">775</div><div class="line">776</div><div class="line">777</div><div class="line">778</div><div class="line">779</div><div class="line">780</div><div class="line">781</div><div class="line">782</div><div class="line">783</div><div class="line">784</div><div class="line">785</div><div class="line">786</div><div class="line">787</div><div class="line">788</div><div class="line">789</div><div class="line">790</div><div class="line">791</div><div class="line">792</div><div class="line">793</div><div class="line">794</div><div class="line">795</div><div class="line">796</div><div class="line">797</div><div class="line">798</div><div class="line">799</div><div class="line">800</div><div class="line">801</div><div class="line">802</div><div class="line">803</div><div class="line">804</div><div class="line">805</div><div class="line">806</div><div class="line">807</div><div class="line">808</div><div class="line">809</div><div class="line">810</div><div class="line">811</div><div class="line">812</div><div class="line">813</div><div class="line">814</div><div class="line">815</div><div class="line">816</div><div class="line">817</div><div class="line">818</div><div class="line">819</div><div class="line">820</div><div class="line">821</div><div class="line">822</div><div class="line">823</div><div class="line">824</div><div class="line">825</div><div class="line">826</div><div class="line">827</div><div class="line">828</div><div class="line">829</div><div class="line">830</div><div class="line">831</div><div class="line">832</div><div class="line">833</div><div class="line">834</div><div class="line">835</div><div class="line">836</div><div class="line">837</div><div class="line">838</div><div class="line">839</div><div class="line">840</div><div class="line">841</div><div class="line">842</div><div class="line">843</div><div class="line">844</div><div class="line">845</div><div class="line">846</div><div class="line">847</div><div class="line">848</div><div class="line">849</div><div class="line">850</div><div class="line">851</div><div class="line">852</div><div class="line">853</div><div class="line">854</div><div class="line">855</div><div class="line">856</div><div class="line">857</div><div class="line">858</div><div class="line">859</div><div class="line">860</div><div class="line">861</div><div class="line">862</div><div class="line">863</div><div class="line">864</div><div class="line">865</div><div class="line">866</div><div class="line">867</div><div class="line">868</div><div class="line">869</div><div class="line">870</div><div class="line">871</div><div class="line">872</div><div class="line">873</div><div class="line">874</div><div class="line">875</div><div class="line">876</div><div class="line">877</div><div class="line">878</div><div class="line">879</div><div class="line">880</div><div class="line">881</div><div class="line">882</div><div class="line">883</div><div class="line">884</div><div class="line">885</div><div class="line">886</div><div class="line">887</div><div class="line">888</div><div class="line">889</div><div class="line">890</div><div class="line">891</div><div class="line">892</div><div class="line">893</div><div class="line">894</div><div class="line">895</div><div class="line">896</div><div class="line">897</div><div class="line">898</div><div class="line">899</div><div class="line">900</div><div class="line">901</div><div class="line">902</div><div class="line">903</div><div class="line">904</div><div class="line">905</div><div class="line">906</div><div class="line">907</div><div class="line">908</div><div class="line">909</div><div class="line">910</div><div class="line">911</div><div class="line">912</div><div class="line">913</div><div class="line">914</div><div class="line">915</div><div class="line">916</div><div class="line">917</div><div class="line">918</div><div class="line">919</div><div class="line">920</div><div class="line">921</div><div class="line">922</div><div class="line">923</div><div class="line">924</div><div class="line">925</div><div class="line">926</div><div class="line">927</div><div class="line">928</div><div class="line">929</div><div class="line">930</div><div class="line">931</div><div class="line">932</div><div class="line">933</div><div class="line">934</div><div class="line">935</div><div class="line">936</div><div class="line">937</div><div class="line">938</div><div class="line">939</div><div class="line">940</div><div class="line">941</div><div class="line">942</div><div class="line">943</div><div class="line">944</div><div class="line">945</div><div class="line">946</div><div class="line">947</div><div class="line">948</div><div class="line">949</div><div class="line">950</div><div class="line">951</div><div class="line">952</div><div class="line">953</div><div class="line">954</div><div class="line">955</div><div class="line">956</div><div class="line">957</div><div class="line">958</div><div class="line">959</div><div class="line">960</div><div class="line">961</div><div class="line">962</div><div class="line">963</div><div class="line">964</div><div class="line">965</div><div class="line">966</div><div class="line">967</div><div class="line">968</div><div class="line">969</div><div class="line">970</div><div class="line">971</div><div class="line">972</div><div class="line">973</div><div class="line">974</div><div class="line">975</div><div class="line">976</div><div class="line">977</div><div class="line">978</div><div class="line">979</div><div class="line">980</div><div class="line">981</div><div class="line">982</div><div class="line">983</div><div class="line">984</div><div class="line">985</div><div class="line">986</div><div class="line">987</div><div class="line">988</div><div class="line">989</div><div class="line">990</div><div class="line">991</div><div class="line">992</div><div class="line">993</div><div class="line">994</div><div class="line">995</div><div class="line">996</div><div class="line">997</div><div class="line">998</div><div class="line">999</div><div class="line">1000</div><div class="line">1001</div><div class="line">1002</div><div class="line">1003</div><div class="line">1004</div><div class="line">1005</div><div class="line">1006</div><div class="line">1007</div><div class="line">1008</div><div class="line">1009</div><div class="line">1010</div><div class="line">1011</div><div class="line">1012</div><div class="line">1013</div><div class="line">1014</div><div class="line">1015</div><div class="line">1016</div><div class="line">1017</div><div class="line">1018</div><div class="line">1019</div><div class="line">1020</div><div class="line">1021</div><div class="line">1022</div><div class="line">1023</div><div class="line">1024</div><div class="line">1025</div><div class="line">1026</div><div class="line">1027</div><div class="line">1028</div><div class="line">1029</div><div class="line">1030</div><div class="line">1031</div><div class="line">1032</div><div class="line">1033</div><div class="line">1034</div><div class="line">1035</div><div class="line">1036</div><div class="line">1037</div><div class="line">1038</div><div class="line">1039</div><div class="line">1040</div><div class="line">1041</div><div class="line">1042</div><div class="line">1043</div><div class="line">1044</div><div class="line">1045</div><div class="line">1046</div><div class="line">1047</div><div class="line">1048</div><div class="line">1049</div><div class="line">1050</div><div class="line">1051</div><div class="line">1052</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Redis configuration file example.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Note that in order to read the configuration file, Redis must be</span></div><div class="line"><span class="comment"># started with the file path as first argument:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># ./redis-server /path/to/redis.conf</span></div><div class="line"></div><div class="line"><span class="comment"># Note on units: when memory size is needed, it is possible to specify</span></div><div class="line"><span class="comment"># it in the usual form of 1k 5GB 4M and so forth:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># 1k =&gt; 1000 bytes</span></div><div class="line"><span class="comment"># 1kb =&gt; 1024 bytes</span></div><div class="line"><span class="comment"># 1m =&gt; 1000000 bytes</span></div><div class="line"><span class="comment"># 1mb =&gt; 1024*1024 bytes</span></div><div class="line"><span class="comment"># 1g =&gt; 1000000000 bytes</span></div><div class="line"><span class="comment"># 1gb =&gt; 1024*1024*1024 bytes</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># units are case insensitive so 1GB 1Gb 1gB are all the same.</span></div><div class="line"></div><div class="line"><span class="comment">################################## INCLUDES ###################################</span></div><div class="line"></div><div class="line"><span class="comment"># Include one or more other config files here.  This is useful if you</span></div><div class="line"><span class="comment"># have a standard template that goes to all Redis servers but also need</span></div><div class="line"><span class="comment"># to customize a few per-server settings.  Include files can include</span></div><div class="line"><span class="comment"># other files, so use this wisely.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Notice option "include" won't be rewritten by command "CONFIG REWRITE"</span></div><div class="line"><span class="comment"># from admin or Redis Sentinel. Since Redis always uses the last processed</span></div><div class="line"><span class="comment"># line as value of a configuration directive, you'd better put includes</span></div><div class="line"><span class="comment"># at the beginning of this file to avoid overwriting config change at runtime.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># If instead you are interested in using includes to override configuration</span></div><div class="line"><span class="comment"># options, it is better to use include as the last line.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># include /path/to/local.conf</span></div><div class="line"><span class="comment"># include /path/to/other.conf</span></div><div class="line"></div><div class="line"><span class="comment">################################## NETWORK #####################################</span></div><div class="line"></div><div class="line"><span class="comment"># By default, if no "bind" configuration directive is specified, Redis listens</span></div><div class="line"><span class="comment"># for connections from all the network interfaces available on the server.</span></div><div class="line"><span class="comment"># It is possible to listen to just one or multiple selected interfaces using</span></div><div class="line"><span class="comment"># the "bind" configuration directive, followed by one or more IP addresses.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Examples:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># bind 192.168.1.100 10.0.0.1</span></div><div class="line"><span class="built_in">bind</span> 127.0.0.1 ::1</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># ~~~ WARNING ~~~ If the computer running Redis is directly exposed to the</span></div><div class="line"><span class="comment"># internet, binding to all the interfaces is dangerous and will expose the</span></div><div class="line"><span class="comment"># instance to everybody on the internet. So by default we uncomment the</span></div><div class="line"><span class="comment"># following bind directive, that will force Redis to listen only into</span></div><div class="line"><span class="comment"># the IPv4 lookback interface address (this means Redis will be able to</span></div><div class="line"><span class="comment"># accept connections only from clients running into the same computer it</span></div><div class="line"><span class="comment"># is running).</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># IF YOU ARE SURE YOU WANT YOUR INSTANCE TO LISTEN TO ALL THE INTERFACES</span></div><div class="line"><span class="comment"># JUST COMMENT THE FOLLOWING LINE.</span></div><div class="line"><span class="comment"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></div><div class="line"><span class="built_in">bind</span> 127.0.0.1</div><div class="line"></div><div class="line"><span class="comment"># Protected mode is a layer of security protection, in order to avoid that</span></div><div class="line"><span class="comment"># Redis instances left open on the internet are accessed and exploited.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># When protected mode is on and if:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># 1) The server is not binding explicitly to a set of addresses using the</span></div><div class="line"><span class="comment">#    "bind" directive.</span></div><div class="line"><span class="comment"># 2) No password is configured.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># The server only accepts connections from clients connecting from the</span></div><div class="line"><span class="comment"># IPv4 and IPv6 loopback addresses 127.0.0.1 and ::1, and from Unix domain</span></div><div class="line"><span class="comment"># sockets.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># By default protected mode is enabled. You should disable it only if</span></div><div class="line"><span class="comment"># you are sure you want clients from other hosts to connect to Redis</span></div><div class="line"><span class="comment"># even if no authentication is configured, nor a specific set of interfaces</span></div><div class="line"><span class="comment"># are explicitly listed using the "bind" directive.</span></div><div class="line">protected-mode yes</div><div class="line"></div><div class="line"><span class="comment"># Accept connections on the specified port, default is 7379 (IANA #815344).</span></div><div class="line"><span class="comment"># If port 0 is specified Redis will not listen on a TCP socket.</span></div><div class="line">port 7379</div><div class="line"></div><div class="line"><span class="comment"># TCP listen() backlog.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># In high requests-per-second environments you need an high backlog in order</span></div><div class="line"><span class="comment"># to avoid slow clients connections issues. Note that the Linux kernel</span></div><div class="line"><span class="comment"># will silently truncate it to the value of /proc/sys/net/core/somaxconn so</span></div><div class="line"><span class="comment"># make sure to raise both the value of somaxconn and tcp_max_syn_backlog</span></div><div class="line"><span class="comment"># in order to get the desired effect.</span></div><div class="line">tcp-backlog 511</div><div class="line"></div><div class="line"><span class="comment"># Unix socket.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Specify the path for the Unix socket that will be used to listen for</span></div><div class="line"><span class="comment"># incoming connections. There is no default, so Redis will not listen</span></div><div class="line"><span class="comment"># on a unix socket when not specified.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># unixsocket /tmp/redis.sock</span></div><div class="line"><span class="comment"># unixsocketperm 700</span></div><div class="line"></div><div class="line"><span class="comment"># Close the connection after a client is idle for N seconds (0 to disable)</span></div><div class="line">timeout 0</div><div class="line"></div><div class="line"><span class="comment"># TCP keepalive.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># If non-zero, use SO_KEEPALIVE to send TCP ACKs to clients in absence</span></div><div class="line"><span class="comment"># of communication. This is useful for two reasons:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># 1) Detect dead peers.</span></div><div class="line"><span class="comment"># 2) Take the connection alive from the point of view of network</span></div><div class="line"><span class="comment">#    equipment in the middle.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># On Linux, the specified value (in seconds) is the period used to send ACKs.</span></div><div class="line"><span class="comment"># Note that to close the connection the double of the time is needed.</span></div><div class="line"><span class="comment"># On other kernels the period depends on the kernel configuration.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># A reasonable value for this option is 300 seconds, which is the new</span></div><div class="line"><span class="comment"># Redis default starting with Redis 3.2.1.</span></div><div class="line">tcp-keepalive 300</div><div class="line"></div><div class="line"><span class="comment">################################# GENERAL #####################################</span></div><div class="line"></div><div class="line"><span class="comment"># By default Redis does not run as a daemon. Use 'yes' if you need it.</span></div><div class="line"><span class="comment"># Note that Redis will write a pid file in /usr/local/var/run/redis.pid when daemonized.</span></div><div class="line">daemonize yes</div><div class="line"></div><div class="line"><span class="comment"># If you run Redis from upstart or systemd, Redis can interact with your</span></div><div class="line"><span class="comment"># supervision tree. Options:</span></div><div class="line"><span class="comment">#   supervised no      - no supervision interaction</span></div><div class="line"><span class="comment">#   supervised upstart - signal upstart by putting Redis into SIGSTOP mode</span></div><div class="line"><span class="comment">#   supervised systemd - signal systemd by writing READY=1 to $NOTIFY_SOCKET</span></div><div class="line"><span class="comment">#   supervised auto    - detect upstart or systemd method based on</span></div><div class="line"><span class="comment">#                        UPSTART_JOB or NOTIFY_SOCKET environment variables</span></div><div class="line"><span class="comment"># Note: these supervision methods only signal "process is ready."</span></div><div class="line"><span class="comment">#       They do not enable continuous liveness pings back to your supervisor.</span></div><div class="line">supervised no</div><div class="line"></div><div class="line"><span class="comment"># If a pid file is specified, Redis writes it where specified at startup</span></div><div class="line"><span class="comment"># and removes it at exit.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># When the server runs non daemonized, no pid file is created if none is</span></div><div class="line"><span class="comment"># specified in the configuration. When the server is daemonized, the pid file</span></div><div class="line"><span class="comment"># is used even if not specified, defaulting to "/usr/local/var/run/redis.pid".</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Creating a pid file is best effort: if Redis is not able to create it</span></div><div class="line"><span class="comment"># nothing bad happens, the server will start and run normally.</span></div><div class="line">pidfile /var/run/redis_7379.pid</div><div class="line"></div><div class="line"><span class="comment"># Specify the server verbosity level.</span></div><div class="line"><span class="comment"># This can be one of:</span></div><div class="line"><span class="comment"># debug (a lot of information, useful for development/testing)</span></div><div class="line"><span class="comment"># verbose (many rarely useful info, but not a mess like the debug level)</span></div><div class="line"><span class="comment"># notice (moderately verbose, what you want in production probably)</span></div><div class="line"><span class="comment"># warning (only very important / critical messages are logged)</span></div><div class="line">loglevel notice</div><div class="line"></div><div class="line"><span class="comment"># Specify the log file name. Also the empty string can be used to force</span></div><div class="line"><span class="comment"># Redis to log on the standard output. Note that if you use standard</span></div><div class="line"><span class="comment"># output for logging but daemonize, logs will be sent to /dev/null</span></div><div class="line">logfile <span class="string">"/data/log/redis.7379.log"</span></div><div class="line"></div><div class="line"><span class="comment"># To enable logging to the system logger, just set 'syslog-enabled' to yes,</span></div><div class="line"><span class="comment"># and optionally update the other syslog parameters to suit your needs.</span></div><div class="line"><span class="comment"># syslog-enabled no</span></div><div class="line"></div><div class="line"><span class="comment"># Specify the syslog identity.</span></div><div class="line"><span class="comment"># syslog-ident redis</span></div><div class="line"></div><div class="line"><span class="comment"># Specify the syslog facility. Must be USER or between LOCAL0-LOCAL7.</span></div><div class="line"><span class="comment"># syslog-facility local0</span></div><div class="line"></div><div class="line"><span class="comment"># Set the number of databases. The default database is DB 0, you can select</span></div><div class="line"><span class="comment"># a different one on a per-connection basis using SELECT &lt;dbid&gt; where</span></div><div class="line"><span class="comment"># dbid is a number between 0 and 'databases'-1</span></div><div class="line">databases 16</div><div class="line"></div><div class="line"><span class="comment">################################ SNAPSHOTTING  ################################</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Save the DB on disk:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#   save &lt;seconds&gt; &lt;changes&gt;</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#   Will save the DB if both the given number of seconds and the given</span></div><div class="line"><span class="comment">#   number of write operations against the DB occurred.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#   In the example below the behaviour will be to save:</span></div><div class="line"><span class="comment">#   after 900 sec (15 min) if at least 1 key changed</span></div><div class="line"><span class="comment">#   after 300 sec (5 min) if at least 10 keys changed</span></div><div class="line"><span class="comment">#   after 60 sec if at least 10000 keys changed</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#   Note: you can disable saving completely by commenting out all "save" lines.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#   It is also possible to remove all the previously configured save</span></div><div class="line"><span class="comment">#   points by adding a save directive with a single empty string argument</span></div><div class="line"><span class="comment">#   like in the following example:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#   save ""</span></div><div class="line"></div><div class="line">save 900 1</div><div class="line">save 300 10</div><div class="line">save 60 10000</div><div class="line"></div><div class="line"><span class="comment"># By default Redis will stop accepting writes if RDB snapshots are enabled</span></div><div class="line"><span class="comment"># (at least one save point) and the latest background save failed.</span></div><div class="line"><span class="comment"># This will make the user aware (in a hard way) that data is not persisting</span></div><div class="line"><span class="comment"># on disk properly, otherwise chances are that no one will notice and some</span></div><div class="line"><span class="comment"># disaster will happen.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># If the background saving process will start working again Redis will</span></div><div class="line"><span class="comment"># automatically allow writes again.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># However if you have setup your proper monitoring of the Redis server</span></div><div class="line"><span class="comment"># and persistence, you may want to disable this feature so that Redis will</span></div><div class="line"><span class="comment"># continue to work as usual even if there are problems with disk,</span></div><div class="line"><span class="comment"># permissions, and so forth.</span></div><div class="line">stop-writes-on-bgsave-error yes</div><div class="line"></div><div class="line"><span class="comment"># Compress string objects using LZF when dump .rdb databases?</span></div><div class="line"><span class="comment"># For default that's set to 'yes' as it's almost always a win.</span></div><div class="line"><span class="comment"># If you want to save some CPU in the saving child set it to 'no' but</span></div><div class="line"><span class="comment"># the dataset will likely be bigger if you have compressible values or keys.</span></div><div class="line">rdbcompression yes</div><div class="line"></div><div class="line"><span class="comment"># Since version 5 of RDB a CRC64 checksum is placed at the end of the file.</span></div><div class="line"><span class="comment"># This makes the format more resistant to corruption but there is a performance</span></div><div class="line"><span class="comment"># hit to pay (around 10%) when saving and loading RDB files, so you can disable it</span></div><div class="line"><span class="comment"># for maximum performances.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># RDB files created with checksum disabled have a checksum of zero that will</span></div><div class="line"><span class="comment"># tell the loading code to skip the check.</span></div><div class="line">rdbchecksum yes</div><div class="line"></div><div class="line"><span class="comment"># The filename where to dump the DB</span></div><div class="line">dbfilename 7379.rdb</div><div class="line"></div><div class="line"><span class="comment"># The working directory.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># The DB will be written inside this directory, with the filename specified</span></div><div class="line"><span class="comment"># above using the 'dbfilename' configuration directive.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># The Append Only File will also be created inside this directory.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Note that you must specify a directory here, not a file name.</span></div><div class="line">dir /usr/<span class="built_in">local</span>/var/db/redis/</div><div class="line"></div><div class="line"><span class="comment">################################# REPLICATION #################################</span></div><div class="line"></div><div class="line"><span class="comment"># Master-Slave replication. Use slaveof to make a Redis instance a copy of</span></div><div class="line"><span class="comment"># another Redis server. A few things to understand ASAP about Redis replication.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># 1) Redis replication is asynchronous, but you can configure a master to</span></div><div class="line"><span class="comment">#    stop accepting writes if it appears to be not connected with at least</span></div><div class="line"><span class="comment">#    a given number of slaves.</span></div><div class="line"><span class="comment"># 2) Redis slaves are able to perform a partial resynchronization with the</span></div><div class="line"><span class="comment">#    master if the replication link is lost for a relatively small amount of</span></div><div class="line"><span class="comment">#    time. You may want to configure the replication backlog size (see the next</span></div><div class="line"><span class="comment">#    sections of this file) with a sensible value depending on your needs.</span></div><div class="line"><span class="comment"># 3) Replication is automatic and does not need user intervention. After a</span></div><div class="line"><span class="comment">#    network partition slaves automatically try to reconnect to masters</span></div><div class="line"><span class="comment">#    and resynchronize with them.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># slaveof &lt;masterip&gt; &lt;masterport&gt;</span></div><div class="line"></div><div class="line"><span class="comment"># If the master is password protected (using the "requirepass" configuration</span></div><div class="line"><span class="comment"># directive below) it is possible to tell the slave to authenticate before</span></div><div class="line"><span class="comment"># starting the replication synchronization process, otherwise the master will</span></div><div class="line"><span class="comment"># refuse the slave request.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># masterauth &lt;master-password&gt;</span></div><div class="line"></div><div class="line"><span class="comment"># When a slave loses its connection with the master, or when the replication</span></div><div class="line"><span class="comment"># is still in progress, the slave can act in two different ways:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># 1) if slave-serve-stale-data is set to 'yes' (the default) the slave will</span></div><div class="line"><span class="comment">#    still reply to client requests, possibly with out of date data, or the</span></div><div class="line"><span class="comment">#    data set may just be empty if this is the first synchronization.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># 2) if slave-serve-stale-data is set to 'no' the slave will reply with</span></div><div class="line"><span class="comment">#    an error "SYNC with master in progress" to all the kind of commands</span></div><div class="line"><span class="comment">#    but to INFO and SLAVEOF.</span></div><div class="line"><span class="comment">#</span></div><div class="line">slave-serve-stale-data yes</div><div class="line"></div><div class="line"><span class="comment"># You can configure a slave instance to accept writes or not. Writing against</span></div><div class="line"><span class="comment"># a slave instance may be useful to store some ephemeral data (because data</span></div><div class="line"><span class="comment"># written on a slave will be easily deleted after resync with the master) but</span></div><div class="line"><span class="comment"># may also cause problems if clients are writing to it because of a</span></div><div class="line"><span class="comment"># misconfiguration.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Since Redis 2.6 by default slaves are read-only.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Note: read only slaves are not designed to be exposed to untrusted clients</span></div><div class="line"><span class="comment"># on the internet. It's just a protection layer against misuse of the instance.</span></div><div class="line"><span class="comment"># Still a read only slave exports by default all the administrative commands</span></div><div class="line"><span class="comment"># such as CONFIG, DEBUG, and so forth. To a limited extent you can improve</span></div><div class="line"><span class="comment"># security of read only slaves using 'rename-command' to shadow all the</span></div><div class="line"><span class="comment"># administrative / dangerous commands.</span></div><div class="line">slave-read-only yes</div><div class="line"></div><div class="line"><span class="comment"># Replication SYNC strategy: disk or socket.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># -------------------------------------------------------</span></div><div class="line"><span class="comment"># WARNING: DISKLESS REPLICATION IS EXPERIMENTAL CURRENTLY</span></div><div class="line"><span class="comment"># -------------------------------------------------------</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># New slaves and reconnecting slaves that are not able to continue the replication</span></div><div class="line"><span class="comment"># process just receiving differences, need to do what is called a "full</span></div><div class="line"><span class="comment"># synchronization". An RDB file is transmitted from the master to the slaves.</span></div><div class="line"><span class="comment"># The transmission can happen in two different ways:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># 1) Disk-backed: The Redis master creates a new process that writes the RDB</span></div><div class="line"><span class="comment">#                 file on disk. Later the file is transferred by the parent</span></div><div class="line"><span class="comment">#                 process to the slaves incrementally.</span></div><div class="line"><span class="comment"># 2) Diskless: The Redis master creates a new process that directly writes the</span></div><div class="line"><span class="comment">#              RDB file to slave sockets, without touching the disk at all.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># With disk-backed replication, while the RDB file is generated, more slaves</span></div><div class="line"><span class="comment"># can be queued and served with the RDB file as soon as the current child producing</span></div><div class="line"><span class="comment"># the RDB file finishes its work. With diskless replication instead once</span></div><div class="line"><span class="comment"># the transfer starts, new slaves arriving will be queued and a new transfer</span></div><div class="line"><span class="comment"># will start when the current one terminates.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># When diskless replication is used, the master waits a configurable amount of</span></div><div class="line"><span class="comment"># time (in seconds) before starting the transfer in the hope that multiple slaves</span></div><div class="line"><span class="comment"># will arrive and the transfer can be parallelized.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># With slow disks and fast (large bandwidth) networks, diskless replication</span></div><div class="line"><span class="comment"># works better.</span></div><div class="line">repl-diskless-sync no</div><div class="line"></div><div class="line"><span class="comment"># When diskless replication is enabled, it is possible to configure the delay</span></div><div class="line"><span class="comment"># the server waits in order to spawn the child that transfers the RDB via socket</span></div><div class="line"><span class="comment"># to the slaves.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># This is important since once the transfer starts, it is not possible to serve</span></div><div class="line"><span class="comment"># new slaves arriving, that will be queued for the next RDB transfer, so the server</span></div><div class="line"><span class="comment"># waits a delay in order to let more slaves arrive.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># The delay is specified in seconds, and by default is 5 seconds. To disable</span></div><div class="line"><span class="comment"># it entirely just set it to 0 seconds and the transfer will start ASAP.</span></div><div class="line">repl-diskless-sync-delay 5</div><div class="line"></div><div class="line"><span class="comment"># Slaves send PINGs to server in a predefined interval. It's possible to change</span></div><div class="line"><span class="comment"># this interval with the repl_ping_slave_period option. The default value is 10</span></div><div class="line"><span class="comment"># seconds.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># repl-ping-slave-period 10</span></div><div class="line"></div><div class="line"><span class="comment"># The following option sets the replication timeout for:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># 1) Bulk transfer I/O during SYNC, from the point of view of slave.</span></div><div class="line"><span class="comment"># 2) Master timeout from the point of view of slaves (data, pings).</span></div><div class="line"><span class="comment"># 3) Slave timeout from the point of view of masters (REPLCONF ACK pings).</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># It is important to make sure that this value is greater than the value</span></div><div class="line"><span class="comment"># specified for repl-ping-slave-period otherwise a timeout will be detected</span></div><div class="line"><span class="comment"># every time there is low traffic between the master and the slave.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># repl-timeout 60</span></div><div class="line"></div><div class="line"><span class="comment"># Disable TCP_NODELAY on the slave socket after SYNC?</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># If you select "yes" Redis will use a smaller number of TCP packets and</span></div><div class="line"><span class="comment"># less bandwidth to send data to slaves. But this can add a delay for</span></div><div class="line"><span class="comment"># the data to appear on the slave side, up to 40 milliseconds with</span></div><div class="line"><span class="comment"># Linux kernels using a default configuration.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># If you select "no" the delay for data to appear on the slave side will</span></div><div class="line"><span class="comment"># be reduced but more bandwidth will be used for replication.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># By default we optimize for low latency, but in very high traffic conditions</span></div><div class="line"><span class="comment"># or when the master and slaves are many hops away, turning this to "yes" may</span></div><div class="line"><span class="comment"># be a good idea.</span></div><div class="line">repl-disable-tcp-nodelay no</div><div class="line"></div><div class="line"><span class="comment"># Set the replication backlog size. The backlog is a buffer that accumulates</span></div><div class="line"><span class="comment"># slave data when slaves are disconnected for some time, so that when a slave</span></div><div class="line"><span class="comment"># wants to reconnect again, often a full resync is not needed, but a partial</span></div><div class="line"><span class="comment"># resync is enough, just passing the portion of data the slave missed while</span></div><div class="line"><span class="comment"># disconnected.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># The bigger the replication backlog, the longer the time the slave can be</span></div><div class="line"><span class="comment"># disconnected and later be able to perform a partial resynchronization.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># The backlog is only allocated once there is at least a slave connected.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># repl-backlog-size 1mb</span></div><div class="line"></div><div class="line"><span class="comment"># After a master has no longer connected slaves for some time, the backlog</span></div><div class="line"><span class="comment"># will be freed. The following option configures the amount of seconds that</span></div><div class="line"><span class="comment"># need to elapse, starting from the time the last slave disconnected, for</span></div><div class="line"><span class="comment"># the backlog buffer to be freed.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># A value of 0 means to never release the backlog.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># repl-backlog-ttl 3600</span></div><div class="line"></div><div class="line"><span class="comment"># The slave priority is an integer number published by Redis in the INFO output.</span></div><div class="line"><span class="comment"># It is used by Redis Sentinel in order to select a slave to promote into a</span></div><div class="line"><span class="comment"># master if the master is no longer working correctly.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># A slave with a low priority number is considered better for promotion, so</span></div><div class="line"><span class="comment"># for instance if there are three slaves with priority 10, 100, 25 Sentinel will</span></div><div class="line"><span class="comment"># pick the one with priority 10, that is the lowest.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># However a special priority of 0 marks the slave as not able to perform the</span></div><div class="line"><span class="comment"># role of master, so a slave with priority of 0 will never be selected by</span></div><div class="line"><span class="comment"># Redis Sentinel for promotion.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># By default the priority is 100.</span></div><div class="line">slave-priority 100</div><div class="line"></div><div class="line"><span class="comment"># It is possible for a master to stop accepting writes if there are less than</span></div><div class="line"><span class="comment"># N slaves connected, having a lag less or equal than M seconds.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># The N slaves need to be in "online" state.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># The lag in seconds, that must be &lt;= the specified value, is calculated from</span></div><div class="line"><span class="comment"># the last ping received from the slave, that is usually sent every second.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># This option does not GUARANTEE that N replicas will accept the write, but</span></div><div class="line"><span class="comment"># will limit the window of exposure for lost writes in case not enough slaves</span></div><div class="line"><span class="comment"># are available, to the specified number of seconds.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># For example to require at least 3 slaves with a lag &lt;= 10 seconds use:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># min-slaves-to-write 3</span></div><div class="line"><span class="comment"># min-slaves-max-lag 10</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Setting one or the other to 0 disables the feature.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># By default min-slaves-to-write is set to 0 (feature disabled) and</span></div><div class="line"><span class="comment"># min-slaves-max-lag is set to 10.</span></div><div class="line"></div><div class="line"><span class="comment"># A Redis master is able to list the address and port of the attached</span></div><div class="line"><span class="comment"># slaves in different ways. For example the "INFO replication" section</span></div><div class="line"><span class="comment"># offers this information, which is used, among other tools, by</span></div><div class="line"><span class="comment"># Redis Sentinel in order to discover slave instances.</span></div><div class="line"><span class="comment"># Another place where this info is available is in the output of the</span></div><div class="line"><span class="comment"># "ROLE" command of a masteer.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># The listed IP and address normally reported by a slave is obtained</span></div><div class="line"><span class="comment"># in the following way:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#   IP: The address is auto detected by checking the peer address</span></div><div class="line"><span class="comment">#   of the socket used by the slave to connect with the master.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#   Port: The port is communicated by the slave during the replication</span></div><div class="line"><span class="comment">#   handshake, and is normally the port that the slave is using to</span></div><div class="line"><span class="comment">#   list for connections.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># However when port forwarding or Network Address Translation (NAT) is</span></div><div class="line"><span class="comment"># used, the slave may be actually reachable via different IP and port</span></div><div class="line"><span class="comment"># pairs. The following two options can be used by a slave in order to</span></div><div class="line"><span class="comment"># report to its master a specific set of IP and port, so that both INFO</span></div><div class="line"><span class="comment"># and ROLE will report those values.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># There is no need to use both the options if you need to override just</span></div><div class="line"><span class="comment"># the port or the IP address.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># slave-announce-ip 5.5.5.5</span></div><div class="line"><span class="comment"># slave-announce-port 1234</span></div><div class="line"></div><div class="line"><span class="comment">################################## SECURITY ###################################</span></div><div class="line"></div><div class="line"><span class="comment"># Require clients to issue AUTH &lt;PASSWORD&gt; before processing any other</span></div><div class="line"><span class="comment"># commands.  This might be useful in environments in which you do not trust</span></div><div class="line"><span class="comment"># others with access to the host running redis-server.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># This should stay commented out for backward compatibility and because most</span></div><div class="line"><span class="comment"># people do not need auth (e.g. they run their own servers).</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Warning: since Redis is pretty fast an outside user can try up to</span></div><div class="line"><span class="comment"># 150k passwords per second against a good box. This means that you should</span></div><div class="line"><span class="comment"># use a very strong password otherwise it will be very easy to break.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># requirepass foobared</span></div><div class="line"></div><div class="line"><span class="comment"># Command renaming.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># It is possible to change the name of dangerous commands in a shared</span></div><div class="line"><span class="comment"># environment. For instance the CONFIG command may be renamed into something</span></div><div class="line"><span class="comment"># hard to guess so that it will still be available for internal-use tools</span></div><div class="line"><span class="comment"># but not available for general clients.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Example:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># It is also possible to completely kill a command by renaming it into</span></div><div class="line"><span class="comment"># an empty string:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># rename-command CONFIG ""</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Please note that changing the name of commands that are logged into the</span></div><div class="line"><span class="comment"># AOF file or transmitted to slaves may cause problems.</span></div><div class="line"></div><div class="line"><span class="comment">################################### LIMITS ####################################</span></div><div class="line"></div><div class="line"><span class="comment"># Set the max number of connected clients at the same time. By default</span></div><div class="line"><span class="comment"># this limit is set to 10000 clients, however if the Redis server is not</span></div><div class="line"><span class="comment"># able to configure the process file limit to allow for the specified limit</span></div><div class="line"><span class="comment"># the max number of allowed clients is set to the current file limit</span></div><div class="line"><span class="comment"># minus 32 (as Redis reserves a few file descriptors for internal uses).</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Once the limit is reached Redis will close all the new connections sending</span></div><div class="line"><span class="comment"># an error 'max number of clients reached'.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># maxclients 10000</span></div><div class="line"></div><div class="line"><span class="comment"># Don't use more memory than the specified amount of bytes.</span></div><div class="line"><span class="comment"># When the memory limit is reached Redis will try to remove keys</span></div><div class="line"><span class="comment"># according to the eviction policy selected (see maxmemory-policy).</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># If Redis can't remove keys according to the policy, or if the policy is</span></div><div class="line"><span class="comment"># set to 'noeviction', Redis will start to reply with errors to commands</span></div><div class="line"><span class="comment"># that would use more memory, like SET, LPUSH, and so on, and will continue</span></div><div class="line"><span class="comment"># to reply to read-only commands like GET.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># This option is usually useful when using Redis as an LRU cache, or to set</span></div><div class="line"><span class="comment"># a hard memory limit for an instance (using the 'noeviction' policy).</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># WARNING: If you have slaves attached to an instance with maxmemory on,</span></div><div class="line"><span class="comment"># the size of the output buffers needed to feed the slaves are subtracted</span></div><div class="line"><span class="comment"># from the used memory count, so that network problems / resyncs will</span></div><div class="line"><span class="comment"># not trigger a loop where keys are evicted, and in turn the output</span></div><div class="line"><span class="comment"># buffer of slaves is full with DELs of keys evicted triggering the deletion</span></div><div class="line"><span class="comment"># of more keys, and so forth until the database is completely emptied.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># In short... if you have slaves attached it is suggested that you set a lower</span></div><div class="line"><span class="comment"># limit for maxmemory so that there is some free RAM on the system for slave</span></div><div class="line"><span class="comment"># output buffers (but this is not needed if the policy is 'noeviction').</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># maxmemory &lt;bytes&gt;</span></div><div class="line"></div><div class="line"><span class="comment"># MAXMEMORY POLICY: how Redis will select what to remove when maxmemory</span></div><div class="line"><span class="comment"># is reached. You can select among five behaviors:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># volatile-lru -&gt; remove the key with an expire set using an LRU algorithm</span></div><div class="line"><span class="comment"># allkeys-lru -&gt; remove any key according to the LRU algorithm</span></div><div class="line"><span class="comment"># volatile-random -&gt; remove a random key with an expire set</span></div><div class="line"><span class="comment"># allkeys-random -&gt; remove a random key, any key</span></div><div class="line"><span class="comment"># volatile-ttl -&gt; remove the key with the nearest expire time (minor TTL)</span></div><div class="line"><span class="comment"># noeviction -&gt; don't expire at all, just return an error on write operations</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Note: with any of the above policies, Redis will return an error on write</span></div><div class="line"><span class="comment">#       operations, when there are no suitable keys for eviction.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#       At the date of writing these commands are: set setnx setex append</span></div><div class="line"><span class="comment">#       incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd</span></div><div class="line"><span class="comment">#       sinter sinterstore sunion sunionstore sdiff sdiffstore zadd zincrby</span></div><div class="line"><span class="comment">#       zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby</span></div><div class="line"><span class="comment">#       getset mset msetnx exec sort</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># The default is:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># maxmemory-policy noeviction</span></div><div class="line"></div><div class="line"><span class="comment"># LRU and minimal TTL algorithms are not precise algorithms but approximated</span></div><div class="line"><span class="comment"># algorithms (in order to save memory), so you can tune it for speed or</span></div><div class="line"><span class="comment"># accuracy. For default Redis will check five keys and pick the one that was</span></div><div class="line"><span class="comment"># used less recently, you can change the sample size using the following</span></div><div class="line"><span class="comment"># configuration directive.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># The default of 5 produces good enough results. 10 Approximates very closely</span></div><div class="line"><span class="comment"># true LRU but costs a bit more CPU. 3 is very fast but not very accurate.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># maxmemory-samples 5</span></div><div class="line"></div><div class="line"><span class="comment">############################## APPEND ONLY MODE ###############################</span></div><div class="line"></div><div class="line"><span class="comment"># By default Redis asynchronously dumps the dataset on disk. This mode is</span></div><div class="line"><span class="comment"># good enough in many applications, but an issue with the Redis process or</span></div><div class="line"><span class="comment"># a power outage may result into a few minutes of writes lost (depending on</span></div><div class="line"><span class="comment"># the configured save points).</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># The Append Only File is an alternative persistence mode that provides</span></div><div class="line"><span class="comment"># much better durability. For instance using the default data fsync policy</span></div><div class="line"><span class="comment"># (see later in the config file) Redis can lose just one second of writes in a</span></div><div class="line"><span class="comment"># dramatic event like a server power outage, or a single write if something</span></div><div class="line"><span class="comment"># wrong with the Redis process itself happens, but the operating system is</span></div><div class="line"><span class="comment"># still running correctly.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># AOF and RDB persistence can be enabled at the same time without problems.</span></div><div class="line"><span class="comment"># If the AOF is enabled on startup Redis will load the AOF, that is the file</span></div><div class="line"><span class="comment"># with the better durability guarantees.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Please check http://redis.io/topics/persistence for more information.</span></div><div class="line"></div><div class="line">appendonly yes</div><div class="line"></div><div class="line"><span class="comment"># The name of the append only file (default: "appendonly.aof")</span></div><div class="line"></div><div class="line">appendfilename <span class="string">"7379.appendonly.aof"</span></div><div class="line"></div><div class="line"><span class="comment"># The fsync() call tells the Operating System to actually write data on disk</span></div><div class="line"><span class="comment"># instead of waiting for more data in the output buffer. Some OS will really flush</span></div><div class="line"><span class="comment"># data on disk, some other OS will just try to do it ASAP.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Redis supports three different modes:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># no: don't fsync, just let the OS flush the data when it wants. Faster.</span></div><div class="line"><span class="comment"># always: fsync after every write to the append only log. Slow, Safest.</span></div><div class="line"><span class="comment"># everysec: fsync only one time every second. Compromise.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># The default is "everysec", as that's usually the right compromise between</span></div><div class="line"><span class="comment"># speed and data safety. It's up to you to understand if you can relax this to</span></div><div class="line"><span class="comment"># "no" that will let the operating system flush the output buffer when</span></div><div class="line"><span class="comment"># it wants, for better performances (but if you can live with the idea of</span></div><div class="line"><span class="comment"># some data loss consider the default persistence mode that's snapshotting),</span></div><div class="line"><span class="comment"># or on the contrary, use "always" that's very slow but a bit safer than</span></div><div class="line"><span class="comment"># everysec.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># More details please check the following article:</span></div><div class="line"><span class="comment"># http://antirez.com/post/redis-persistence-demystified.html</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># If unsure, use "everysec".</span></div><div class="line"></div><div class="line"><span class="comment"># appendfsync always</span></div><div class="line">appendfsync everysec</div><div class="line"><span class="comment"># appendfsync no</span></div><div class="line"></div><div class="line"><span class="comment"># When the AOF fsync policy is set to always or everysec, and a background</span></div><div class="line"><span class="comment"># saving process (a background save or AOF log background rewriting) is</span></div><div class="line"><span class="comment"># performing a lot of I/O against the disk, in some Linux configurations</span></div><div class="line"><span class="comment"># Redis may block too long on the fsync() call. Note that there is no fix for</span></div><div class="line"><span class="comment"># this currently, as even performing fsync in a different thread will block</span></div><div class="line"><span class="comment"># our synchronous write(2) call.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># In order to mitigate this problem it's possible to use the following option</span></div><div class="line"><span class="comment"># that will prevent fsync() from being called in the main process while a</span></div><div class="line"><span class="comment"># BGSAVE or BGREWRITEAOF is in progress.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># This means that while another child is saving, the durability of Redis is</span></div><div class="line"><span class="comment"># the same as "appendfsync none". In practical terms, this means that it is</span></div><div class="line"><span class="comment"># possible to lose up to 30 seconds of log in the worst scenario (with the</span></div><div class="line"><span class="comment"># default Linux settings).</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># If you have latency problems turn this to "yes". Otherwise leave it as</span></div><div class="line"><span class="comment"># "no" that is the safest pick from the point of view of durability.</span></div><div class="line"></div><div class="line">no-appendfsync-on-rewrite no</div><div class="line"></div><div class="line"><span class="comment"># Automatic rewrite of the append only file.</span></div><div class="line"><span class="comment"># Redis is able to automatically rewrite the log file implicitly calling</span></div><div class="line"><span class="comment"># BGREWRITEAOF when the AOF log size grows by the specified percentage.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># This is how it works: Redis remembers the size of the AOF file after the</span></div><div class="line"><span class="comment"># latest rewrite (if no rewrite has happened since the restart, the size of</span></div><div class="line"><span class="comment"># the AOF at startup is used).</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># This base size is compared to the current size. If the current size is</span></div><div class="line"><span class="comment"># bigger than the specified percentage, the rewrite is triggered. Also</span></div><div class="line"><span class="comment"># you need to specify a minimal size for the AOF file to be rewritten, this</span></div><div class="line"><span class="comment"># is useful to avoid rewriting the AOF file even if the percentage increase</span></div><div class="line"><span class="comment"># is reached but it is still pretty small.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Specify a percentage of zero in order to disable the automatic AOF</span></div><div class="line"><span class="comment"># rewrite feature.</span></div><div class="line"></div><div class="line">auto-aof-rewrite-percentage 100</div><div class="line">auto-aof-rewrite-min-size 64mb</div><div class="line"></div><div class="line"><span class="comment"># An AOF file may be found to be truncated at the end during the Redis</span></div><div class="line"><span class="comment"># startup process, when the AOF data gets loaded back into memory.</span></div><div class="line"><span class="comment"># This may happen when the system where Redis is running</span></div><div class="line"><span class="comment"># crashes, especially when an ext4 filesystem is mounted without the</span></div><div class="line"><span class="comment"># data=ordered option (however this can't happen when Redis itself</span></div><div class="line"><span class="comment"># crashes or aborts but the operating system still works correctly).</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Redis can either exit with an error when this happens, or load as much</span></div><div class="line"><span class="comment"># data as possible (the default now) and start if the AOF file is found</span></div><div class="line"><span class="comment"># to be truncated at the end. The following option controls this behavior.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># If aof-load-truncated is set to yes, a truncated AOF file is loaded and</span></div><div class="line"><span class="comment"># the Redis server starts emitting a log to inform the user of the event.</span></div><div class="line"><span class="comment"># Otherwise if the option is set to no, the server aborts with an error</span></div><div class="line"><span class="comment"># and refuses to start. When the option is set to no, the user requires</span></div><div class="line"><span class="comment"># to fix the AOF file using the "redis-check-aof" utility before to restart</span></div><div class="line"><span class="comment"># the server.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Note that if the AOF file will be found to be corrupted in the middle</span></div><div class="line"><span class="comment"># the server will still exit with an error. This option only applies when</span></div><div class="line"><span class="comment"># Redis will try to read more data from the AOF file but not enough bytes</span></div><div class="line"><span class="comment"># will be found.</span></div><div class="line">aof-load-truncated yes</div><div class="line"></div><div class="line"><span class="comment">################################ LUA SCRIPTING  ###############################</span></div><div class="line"></div><div class="line"><span class="comment"># Max execution time of a Lua script in milliseconds.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># If the maximum execution time is reached Redis will log that a script is</span></div><div class="line"><span class="comment"># still in execution after the maximum allowed time and will start to</span></div><div class="line"><span class="comment"># reply to queries with an error.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># When a long running script exceeds the maximum execution time only the</span></div><div class="line"><span class="comment"># SCRIPT KILL and SHUTDOWN NOSAVE commands are available. The first can be</span></div><div class="line"><span class="comment"># used to stop a script that did not yet called write commands. The second</span></div><div class="line"><span class="comment"># is the only way to shut down the server in the case a write command was</span></div><div class="line"><span class="comment"># already issued by the script but the user doesn't want to wait for the natural</span></div><div class="line"><span class="comment"># termination of the script.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Set it to 0 or a negative value for unlimited execution without warnings.</span></div><div class="line">lua-time-limit 5000</div><div class="line"></div><div class="line"><span class="comment">################################ REDIS CLUSTER  ###############################</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></div><div class="line"><span class="comment"># WARNING EXPERIMENTAL: Redis Cluster is considered to be stable code, however</span></div><div class="line"><span class="comment"># in order to mark it as "mature" we need to wait for a non trivial percentage</span></div><div class="line"><span class="comment"># of users to deploy it in production.</span></div><div class="line"><span class="comment"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Normal Redis instances can't be part of a Redis Cluster; only nodes that are</span></div><div class="line"><span class="comment"># started as cluster nodes can. In order to start a Redis instance as a</span></div><div class="line"><span class="comment"># cluster node enable the cluster support uncommenting the following:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># cluster-enabled yes</span></div><div class="line"></div><div class="line"><span class="comment"># Every cluster node has a cluster configuration file. This file is not</span></div><div class="line"><span class="comment"># intended to be edited by hand. It is created and updated by Redis nodes.</span></div><div class="line"><span class="comment"># Every Redis Cluster node requires a different cluster configuration file.</span></div><div class="line"><span class="comment"># Make sure that instances running in the same system do not have</span></div><div class="line"><span class="comment"># overlapping cluster configuration file names.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># cluster-config-file nodes.conf</span></div><div class="line"></div><div class="line"><span class="comment"># Cluster node timeout is the amount of milliseconds a node must be unreachable</span></div><div class="line"><span class="comment"># for it to be considered in failure state.</span></div><div class="line"><span class="comment"># Most other internal time limits are multiple of the node timeout.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># cluster-node-timeout 15000</span></div><div class="line"></div><div class="line"><span class="comment"># A slave of a failing master will avoid to start a failover if its data</span></div><div class="line"><span class="comment"># looks too old.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># There is no simple way for a slave to actually have a exact measure of</span></div><div class="line"><span class="comment"># its "data age", so the following two checks are performed:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># 1) If there are multiple slaves able to failover, they exchange messages</span></div><div class="line"><span class="comment">#    in order to try to give an advantage to the slave with the best</span></div><div class="line"><span class="comment">#    replication offset (more data from the master processed).</span></div><div class="line"><span class="comment">#    Slaves will try to get their rank by offset, and apply to the start</span></div><div class="line"><span class="comment">#    of the failover a delay proportional to their rank.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># 2) Every single slave computes the time of the last interaction with</span></div><div class="line"><span class="comment">#    its master. This can be the last ping or command received (if the master</span></div><div class="line"><span class="comment">#    is still in the "connected" state), or the time that elapsed since the</span></div><div class="line"><span class="comment">#    disconnection with the master (if the replication link is currently down).</span></div><div class="line"><span class="comment">#    If the last interaction is too old, the slave will not try to failover</span></div><div class="line"><span class="comment">#    at all.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># The point "2" can be tuned by user. Specifically a slave will not perform</span></div><div class="line"><span class="comment"># the failover if, since the last interaction with the master, the time</span></div><div class="line"><span class="comment"># elapsed is greater than:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#   (node-timeout * slave-validity-factor) + repl-ping-slave-period</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># So for example if node-timeout is 30 seconds, and the slave-validity-factor</span></div><div class="line"><span class="comment"># is 10, and assuming a default repl-ping-slave-period of 10 seconds, the</span></div><div class="line"><span class="comment"># slave will not try to failover if it was not able to talk with the master</span></div><div class="line"><span class="comment"># for longer than 310 seconds.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># A large slave-validity-factor may allow slaves with too old data to failover</span></div><div class="line"><span class="comment"># a master, while a too small value may prevent the cluster from being able to</span></div><div class="line"><span class="comment"># elect a slave at all.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># For maximum availability, it is possible to set the slave-validity-factor</span></div><div class="line"><span class="comment"># to a value of 0, which means, that slaves will always try to failover the</span></div><div class="line"><span class="comment"># master regardless of the last time they interacted with the master.</span></div><div class="line"><span class="comment"># (However they'll always try to apply a delay proportional to their</span></div><div class="line"><span class="comment"># offset rank).</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Zero is the only value able to guarantee that when all the partitions heal</span></div><div class="line"><span class="comment"># the cluster will always be able to continue.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># cluster-slave-validity-factor 10</span></div><div class="line"></div><div class="line"><span class="comment"># Cluster slaves are able to migrate to orphaned masters, that are masters</span></div><div class="line"><span class="comment"># that are left without working slaves. This improves the cluster ability</span></div><div class="line"><span class="comment"># to resist to failures as otherwise an orphaned master can't be failed over</span></div><div class="line"><span class="comment"># in case of failure if it has no working slaves.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Slaves migrate to orphaned masters only if there are still at least a</span></div><div class="line"><span class="comment"># given number of other working slaves for their old master. This number</span></div><div class="line"><span class="comment"># is the "migration barrier". A migration barrier of 1 means that a slave</span></div><div class="line"><span class="comment"># will migrate only if there is at least 1 other working slave for its master</span></div><div class="line"><span class="comment"># and so forth. It usually reflects the number of slaves you want for every</span></div><div class="line"><span class="comment"># master in your cluster.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Default is 1 (slaves migrate only if their masters remain with at least</span></div><div class="line"><span class="comment"># one slave). To disable migration just set it to a very large value.</span></div><div class="line"><span class="comment"># A value of 0 can be set but is useful only for debugging and dangerous</span></div><div class="line"><span class="comment"># in production.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># cluster-migration-barrier 1</span></div><div class="line"></div><div class="line"><span class="comment"># By default Redis Cluster nodes stop accepting queries if they detect there</span></div><div class="line"><span class="comment"># is at least an hash slot uncovered (no available node is serving it).</span></div><div class="line"><span class="comment"># This way if the cluster is partially down (for example a range of hash slots</span></div><div class="line"><span class="comment"># are no longer covered) all the cluster becomes, eventually, unavailable.</span></div><div class="line"><span class="comment"># It automatically returns available as soon as all the slots are covered again.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># However sometimes you want the subset of the cluster which is working,</span></div><div class="line"><span class="comment"># to continue to accept queries for the part of the key space that is still</span></div><div class="line"><span class="comment"># covered. In order to do so, just set the cluster-require-full-coverage</span></div><div class="line"><span class="comment"># option to no.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># cluster-require-full-coverage yes</span></div><div class="line"></div><div class="line"><span class="comment"># In order to setup your cluster make sure to read the documentation</span></div><div class="line"><span class="comment"># available at http://redis.io web site.</span></div><div class="line"></div><div class="line"><span class="comment">################################## SLOW LOG ###################################</span></div><div class="line"></div><div class="line"><span class="comment"># The Redis Slow Log is a system to log queries that exceeded a specified</span></div><div class="line"><span class="comment"># execution time. The execution time does not include the I/O operations</span></div><div class="line"><span class="comment"># like talking with the client, sending the reply and so forth,</span></div><div class="line"><span class="comment"># but just the time needed to actually execute the command (this is the only</span></div><div class="line"><span class="comment"># stage of command execution where the thread is blocked and can not serve</span></div><div class="line"><span class="comment"># other requests in the meantime).</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># You can configure the slow log with two parameters: one tells Redis</span></div><div class="line"><span class="comment"># what is the execution time, in microseconds, to exceed in order for the</span></div><div class="line"><span class="comment"># command to get logged, and the other parameter is the length of the</span></div><div class="line"><span class="comment"># slow log. When a new command is logged the oldest one is removed from the</span></div><div class="line"><span class="comment"># queue of logged commands.</span></div><div class="line"></div><div class="line"><span class="comment"># The following time is expressed in microseconds, so 1000000 is equivalent</span></div><div class="line"><span class="comment"># to one second. Note that a negative number disables the slow log, while</span></div><div class="line"><span class="comment"># a value of zero forces the logging of every command.</span></div><div class="line">slowlog-log-slower-than 10000</div><div class="line"></div><div class="line"><span class="comment"># There is no limit to this length. Just be aware that it will consume memory.</span></div><div class="line"><span class="comment"># You can reclaim memory used by the slow log with SLOWLOG RESET.</span></div><div class="line">slowlog-max-len 128</div><div class="line"></div><div class="line"><span class="comment">################################ LATENCY MONITOR ##############################</span></div><div class="line"></div><div class="line"><span class="comment"># The Redis latency monitoring subsystem samples different operations</span></div><div class="line"><span class="comment"># at runtime in order to collect data related to possible sources of</span></div><div class="line"><span class="comment"># latency of a Redis instance.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Via the LATENCY command this information is available to the user that can</span></div><div class="line"><span class="comment"># print graphs and obtain reports.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># The system only logs operations that were performed in a time equal or</span></div><div class="line"><span class="comment"># greater than the amount of milliseconds specified via the</span></div><div class="line"><span class="comment"># latency-monitor-threshold configuration directive. When its value is set</span></div><div class="line"><span class="comment"># to zero, the latency monitor is turned off.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># By default latency monitoring is disabled since it is mostly not needed</span></div><div class="line"><span class="comment"># if you don't have latency issues, and collecting data has a performance</span></div><div class="line"><span class="comment"># impact, that while very small, can be measured under big load. Latency</span></div><div class="line"><span class="comment"># monitoring can easily be enabled at runtime using the command</span></div><div class="line"><span class="comment"># "CONFIG SET latency-monitor-threshold &lt;milliseconds&gt;" if needed.</span></div><div class="line">latency-monitor-threshold 0</div><div class="line"></div><div class="line"><span class="comment">############################# EVENT NOTIFICATION ##############################</span></div><div class="line"></div><div class="line"><span class="comment"># Redis can notify Pub/Sub clients about events happening in the key space.</span></div><div class="line"><span class="comment"># This feature is documented at http://redis.io/topics/notifications</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># For instance if keyspace events notification is enabled, and a client</span></div><div class="line"><span class="comment"># performs a DEL operation on key "foo" stored in the Database 0, two</span></div><div class="line"><span class="comment"># messages will be published via Pub/Sub:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># PUBLISH __keyspace@0__:foo del</span></div><div class="line"><span class="comment"># PUBLISH __keyevent@0__:del foo</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># It is possible to select the events that Redis will notify among a set</span></div><div class="line"><span class="comment"># of classes. Every class is identified by a single character:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#  K     Keyspace events, published with __keyspace@&lt;db&gt;__ prefix.</span></div><div class="line"><span class="comment">#  E     Keyevent events, published with __keyevent@&lt;db&gt;__ prefix.</span></div><div class="line"><span class="comment">#  g     Generic commands (non-type specific) like DEL, EXPIRE, RENAME, ...</span></div><div class="line"><span class="comment">#  $     String commands</span></div><div class="line"><span class="comment">#  l     List commands</span></div><div class="line"><span class="comment">#  s     Set commands</span></div><div class="line"><span class="comment">#  h     Hash commands</span></div><div class="line"><span class="comment">#  z     Sorted set commands</span></div><div class="line"><span class="comment">#  x     Expired events (events generated every time a key expires)</span></div><div class="line"><span class="comment">#  e     Evicted events (events generated when a key is evicted for maxmemory)</span></div><div class="line"><span class="comment">#  A     Alias for g$lshzxe, so that the "AKE" string means all the events.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#  The "notify-keyspace-events" takes as argument a string that is composed</span></div><div class="line"><span class="comment">#  of zero or multiple characters. The empty string means that notifications</span></div><div class="line"><span class="comment">#  are disabled.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#  Example: to enable list and generic events, from the point of view of the</span></div><div class="line"><span class="comment">#           event name, use:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#  notify-keyspace-events Elg</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#  Example 2: to get the stream of the expired keys subscribing to channel</span></div><div class="line"><span class="comment">#             name __keyevent@0__:expired use:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#  notify-keyspace-events Ex</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#  By default all notifications are disabled because most users don't need</span></div><div class="line"><span class="comment">#  this feature and the feature has some overhead. Note that if you don't</span></div><div class="line"><span class="comment">#  specify at least one of K or E, no events will be delivered.</span></div><div class="line">notify-keyspace-events <span class="string">""</span></div><div class="line"></div><div class="line"><span class="comment">############################### ADVANCED CONFIG ###############################</span></div><div class="line"></div><div class="line"><span class="comment"># Hashes are encoded using a memory efficient data structure when they have a</span></div><div class="line"><span class="comment"># small number of entries, and the biggest entry does not exceed a given</span></div><div class="line"><span class="comment"># threshold. These thresholds can be configured using the following directives.</span></div><div class="line"><span class="built_in">hash</span>-max-ziplist-entries 512</div><div class="line"><span class="built_in">hash</span>-max-ziplist-value 64</div><div class="line"></div><div class="line"><span class="comment"># Lists are also encoded in a special way to save a lot of space.</span></div><div class="line"><span class="comment"># The number of entries allowed per internal list node can be specified</span></div><div class="line"><span class="comment"># as a fixed maximum size or a maximum number of elements.</span></div><div class="line"><span class="comment"># For a fixed maximum size, use -5 through -1, meaning:</span></div><div class="line"><span class="comment"># -5: max size: 64 Kb  &lt;-- not recommended for normal workloads</span></div><div class="line"><span class="comment"># -4: max size: 32 Kb  &lt;-- not recommended</span></div><div class="line"><span class="comment"># -3: max size: 16 Kb  &lt;-- probably not recommended</span></div><div class="line"><span class="comment"># -2: max size: 8 Kb   &lt;-- good</span></div><div class="line"><span class="comment"># -1: max size: 4 Kb   &lt;-- good</span></div><div class="line"><span class="comment"># Positive numbers mean store up to _exactly_ that number of elements</span></div><div class="line"><span class="comment"># per list node.</span></div><div class="line"><span class="comment"># The highest performing option is usually -2 (8 Kb size) or -1 (4 Kb size),</span></div><div class="line"><span class="comment"># but if your use case is unique, adjust the settings as necessary.</span></div><div class="line">list-max-ziplist-size -2</div><div class="line"></div><div class="line"><span class="comment"># Lists may also be compressed.</span></div><div class="line"><span class="comment"># Compress depth is the number of quicklist ziplist nodes from *each* side of</span></div><div class="line"><span class="comment"># the list to *exclude* from compression.  The head and tail of the list</span></div><div class="line"><span class="comment"># are always uncompressed for fast push/pop operations.  Settings are:</span></div><div class="line"><span class="comment"># 0: disable all list compression</span></div><div class="line"><span class="comment"># 1: depth 1 means "don't start compressing until after 1 node into the list,</span></div><div class="line"><span class="comment">#    going from either the head or tail"</span></div><div class="line"><span class="comment">#    So: [head]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[tail]</span></div><div class="line"><span class="comment">#    [head], [tail] will always be uncompressed; inner nodes will compress.</span></div><div class="line"><span class="comment"># 2: [head]-&gt;[next]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[prev]-&gt;[tail]</span></div><div class="line"><span class="comment">#    2 here means: don't compress head or head-&gt;next or tail-&gt;prev or tail,</span></div><div class="line"><span class="comment">#    but compress all nodes between them.</span></div><div class="line"><span class="comment"># 3: [head]-&gt;[next]-&gt;[next]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[prev]-&gt;[prev]-&gt;[tail]</span></div><div class="line"><span class="comment"># etc.</span></div><div class="line">list-compress-depth 0</div><div class="line"></div><div class="line"><span class="comment"># Sets have a special encoding in just one case: when a set is composed</span></div><div class="line"><span class="comment"># of just strings that happen to be integers in radix 10 in the range</span></div><div class="line"><span class="comment"># of 64 bit signed integers.</span></div><div class="line"><span class="comment"># The following configuration setting sets the limit in the size of the</span></div><div class="line"><span class="comment"># set in order to use this special memory saving encoding.</span></div><div class="line"><span class="built_in">set</span>-max-intset-entries 512</div><div class="line"></div><div class="line"><span class="comment"># Similarly to hashes and lists, sorted sets are also specially encoded in</span></div><div class="line"><span class="comment"># order to save a lot of space. This encoding is only used when the length and</span></div><div class="line"><span class="comment"># elements of a sorted set are below the following limits:</span></div><div class="line">zset-max-ziplist-entries 128</div><div class="line">zset-max-ziplist-value 64</div><div class="line"></div><div class="line"><span class="comment"># HyperLogLog sparse representation bytes limit. The limit includes the</span></div><div class="line"><span class="comment"># 16 bytes header. When an HyperLogLog using the sparse representation crosses</span></div><div class="line"><span class="comment"># this limit, it is converted into the dense representation.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># A value greater than 16000 is totally useless, since at that point the</span></div><div class="line"><span class="comment"># dense representation is more memory efficient.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># The suggested value is ~ 3000 in order to have the benefits of</span></div><div class="line"><span class="comment"># the space efficient encoding without slowing down too much PFADD,</span></div><div class="line"><span class="comment"># which is O(N) with the sparse encoding. The value can be raised to</span></div><div class="line"><span class="comment"># ~ 10000 when CPU is not a concern, but space is, and the data set is</span></div><div class="line"><span class="comment"># composed of many HyperLogLogs with cardinality in the 0 - 15000 range.</span></div><div class="line">hll-sparse-max-bytes 3000</div><div class="line"></div><div class="line"><span class="comment"># Active rehashing uses 1 millisecond every 100 milliseconds of CPU time in</span></div><div class="line"><span class="comment"># order to help rehashing the main Redis hash table (the one mapping top-level</span></div><div class="line"><span class="comment"># keys to values). The hash table implementation Redis uses (see dict.c)</span></div><div class="line"><span class="comment"># performs a lazy rehashing: the more operation you run into a hash table</span></div><div class="line"><span class="comment"># that is rehashing, the more rehashing "steps" are performed, so if the</span></div><div class="line"><span class="comment"># server is idle the rehashing is never complete and some more memory is used</span></div><div class="line"><span class="comment"># by the hash table.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># The default is to use this millisecond 10 times every second in order to</span></div><div class="line"><span class="comment"># actively rehash the main dictionaries, freeing memory when possible.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># If unsure:</span></div><div class="line"><span class="comment"># use "activerehashing no" if you have hard latency requirements and it is</span></div><div class="line"><span class="comment"># not a good thing in your environment that Redis can reply from time to time</span></div><div class="line"><span class="comment"># to queries with 2 milliseconds delay.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># use "activerehashing yes" if you don't have such hard requirements but</span></div><div class="line"><span class="comment"># want to free memory asap when possible.</span></div><div class="line">activerehashing yes</div><div class="line"></div><div class="line"><span class="comment"># The client output buffer limits can be used to force disconnection of clients</span></div><div class="line"><span class="comment"># that are not reading data from the server fast enough for some reason (a</span></div><div class="line"><span class="comment"># common reason is that a Pub/Sub client can't consume messages as fast as the</span></div><div class="line"><span class="comment"># publisher can produce them).</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># The limit can be set differently for the three different classes of clients:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># normal -&gt; normal clients including MONITOR clients</span></div><div class="line"><span class="comment"># slave  -&gt; slave clients</span></div><div class="line"><span class="comment"># pubsub -&gt; clients subscribed to at least one pubsub channel or pattern</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># The syntax of every client-output-buffer-limit directive is the following:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># client-output-buffer-limit &lt;class&gt; &lt;hard limit&gt; &lt;soft limit&gt; &lt;soft seconds&gt;</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># A client is immediately disconnected once the hard limit is reached, or if</span></div><div class="line"><span class="comment"># the soft limit is reached and remains reached for the specified number of</span></div><div class="line"><span class="comment"># seconds (continuously).</span></div><div class="line"><span class="comment"># So for instance if the hard limit is 32 megabytes and the soft limit is</span></div><div class="line"><span class="comment"># 16 megabytes / 10 seconds, the client will get disconnected immediately</span></div><div class="line"><span class="comment"># if the size of the output buffers reach 32 megabytes, but will also get</span></div><div class="line"><span class="comment"># disconnected if the client reaches 16 megabytes and continuously overcomes</span></div><div class="line"><span class="comment"># the limit for 10 seconds.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># By default normal clients are not limited because they don't receive data</span></div><div class="line"><span class="comment"># without asking (in a push way), but just after a request, so only</span></div><div class="line"><span class="comment"># asynchronous clients may create a scenario where data is requested faster</span></div><div class="line"><span class="comment"># than it can read.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Instead there is a default limit for pubsub and slave clients, since</span></div><div class="line"><span class="comment"># subscribers and slaves receive data in a push fashion.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Both the hard or the soft limit can be disabled by setting them to zero.</span></div><div class="line">client-output-buffer-limit normal 0 0 0</div><div class="line">client-output-buffer-limit slave 256mb 64mb 60</div><div class="line">client-output-buffer-limit pubsub 32mb 8mb 60</div><div class="line"></div><div class="line"><span class="comment"># Redis calls an internal function to perform many background tasks, like</span></div><div class="line"><span class="comment"># closing connections of clients in timeout, purging expired keys that are</span></div><div class="line"><span class="comment"># never requested, and so forth.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Not all tasks are performed with the same frequency, but Redis checks for</span></div><div class="line"><span class="comment"># tasks to perform according to the specified "hz" value.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># By default "hz" is set to 10. Raising the value will use more CPU when</span></div><div class="line"><span class="comment"># Redis is idle, but at the same time will make Redis more responsive when</span></div><div class="line"><span class="comment"># there are many keys expiring at the same time, and timeouts may be</span></div><div class="line"><span class="comment"># handled with more precision.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># The range is between 1 and 500, however a value over 100 is usually not</span></div><div class="line"><span class="comment"># a good idea. Most users should use the default of 10 and raise this up to</span></div><div class="line"><span class="comment"># 100 only in environments where very low latency is required.</span></div><div class="line">hz 10</div><div class="line"></div><div class="line"><span class="comment"># When a child rewrites the AOF file, if the following option is enabled</span></div><div class="line"><span class="comment"># the file will be fsync-ed every 32 MB of data generated. This is useful</span></div><div class="line"><span class="comment"># in order to commit the file to the disk more incrementally and avoid</span></div><div class="line"><span class="comment"># big latency spikes.</span></div><div class="line">aof-rewrite-incremental-fsync yes</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://yuqiangit.github.io/2017/03/21/liunx/vim/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="walter">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="五年">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/21/liunx/vim/" itemprop="url">mac vim 设置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-21T18:20:44+08:00">
                2017-03-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#mac vim 设置</p>
<p><code>vi ~/.vimrc</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">set ai                  &quot; auto indenting</div><div class="line">set history=100         &quot; keep 100 lines of history</div><div class="line">set ruler               &quot; show the cursor position</div><div class="line">syntax on               &quot; syntax highlighting</div><div class="line">set hlsearch            &quot; highlight the last searched term</div><div class="line">filetype plugin on      &quot; use the file type plugins</div><div class="line"></div><div class="line">&quot; When editing a file, always jump to the last cursor position</div><div class="line">autocmd BufReadPost *</div><div class="line">\ if ! exists(&quot;g:leave_my_cursor_position_alone&quot;) |</div><div class="line">\ if line(&quot;&apos;\&quot;&quot;) &gt; 0 &amp;&amp; line (&quot;&apos;\&quot;&quot;) &lt;= line(&quot;$&quot;) |</div><div class="line">\ exe &quot;normal g&apos;\&quot;&quot; |</div><div class="line">\ endif |</div><div class="line">\ endif</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://yuqiangit.github.io/2017/03/21/liunx/vagrant/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="walter">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="五年">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/21/liunx/vagrant/" itemprop="url">vagrant 虚拟机工具</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-21T18:20:44+08:00">
                2017-03-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="vagrant"><a href="#vagrant" class="headerlink" title=" #vagrant"></a> #<a href="https://www.vagrantup.com/" target="_blank" rel="external">vagrant</a></h2><p> [TOC]</p>
<p> ##install</p>
<p> 创建文件夹</p>
<p> <code>vagrant init ubuntu/trusty64</code></p>
<p> <code>vagrant up --provider virtualbox</code></p>
<p> ##cmd<br> |cmd|描述|<br> |:|<br> |<code>vagrant status</code>|状态<br> |<code>vagrant halt</code>|强制关闭，立刻释放所有的ram<br> |<code>vagrant suspend</code>|挂起|<br> |<code>vagrant up</code>|启动|<br> |<code>vagrant destroy</code>|摧毁机器|<br> |<code>vagrant reload</code>|重启机器|</p>
<p> ##访问控制<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"># Create a forwarded port mapping which allows access to a specific port</div><div class="line"># within the machine from a port on the host machine. In the example below,</div><div class="line"># accessing &quot;localhost:8080&quot; will access port 80 on the guest machine.</div><div class="line"># config.vm.network &quot;forwarded_port&quot;, guest: 80, host: 8080</div><div class="line">Add the following directly below those comments: config.vm.network :forwarded_port, guest: 80, host: 8080</div><div class="line"></div><div class="line">Save the file and start your Vagrant virtual machine using the vagrant up command. If your virtual machine is currently running, you can reload it using the vagrant reload command.</div><div class="line"></div><div class="line"></div><div class="line">This configuration change will setup port forwarding from port 8080 on the host machine (your computer) to the guest machine (your Vagrant virtual machine) when your virtual machine is running. This will allow you to access your web server using the URL http://localhost:8080.</div></pre></td></tr></table></figure></p>
<p> ##smoe lesson<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">Vagrant Commands</div><div class="line">We’re now ready to get started working within our Linux virtual machine. If your download hasn’t completed from the initial setup, go ahead and take a break and come back when that has completed. You won’t be able to make further progress until the virtual machine is up and running as much of the course will take place within this environment.</div><div class="line"></div><div class="line">Before we access our machine, let’s quickly review a few commands that vagrant provides to make managing your virtual machines much simpler. Remember, your vagrant machine lives within this specific folder on your computer so make sure you’re within that same folder your created earlier; otherwise these commands won’t work as expected.</div><div class="line"></div><div class="line">Type vagrant status</div><div class="line">This command will show you the current status of the virtual machine. It should currently read “default running (virtualbox)” along with some other information.</div><div class="line">Type vagrant suspend</div><div class="line">This command suspends your virtual machine. All of your work is saved and the machine is put into a “sleep mode” of sorts. The machines state is saved and it’s very quick to stop and start your work. You should use this command if you plan to just take a short break from your work but don’t want to leave the virtual machine running.</div><div class="line">Type vagrant up</div><div class="line">This gets your virtual machine up and running again. Notice we didn’t have to redownload the virtual machine image, since it’s already been downloaded.</div><div class="line">Type vagrant ssh</div><div class="line">This command will actually connect to and log you into your virtual machine. Once done you will see a few lines of text showing various performance statistics of the virtual machine along with a new command line prompt that reads vagrant@vagrant-ubuntu-trusty-64:~$</div><div class="line">Here are a few other important commands that we’ll discuss but you do not need to practice at this time:</div><div class="line"></div><div class="line">vagrant halt</div><div class="line">This command halts your virtual machine. All of your work is saved and the machine is turned off - think of this as “turning the power off”. It’s much slower to stop and start your virtual machine using this command, but it does free up all of your RAM once the machine has been stopped. You should use this command if you plan to take an extended break from your work, like when you are done for the day. The command vagrant up will turn your machine back on and you can continue your work.</div><div class="line">vagrant destroy</div><div class="line">This command destroys your virtual machine. Your work is not saved, the machine is turned off and forgotten about for the most part. Think of this as formatting the hard drive of a computer. You can always use vagrant up to relaunch the machine but you’ll be left with the baseline Linux installation from the beginning of this course. You should not have to use this command at any time during this course unless, at some point in time, you perform a task on the virtual machine that makes it completely inoperable.</div></pre></td></tr></table></figure></p>
<p> <strong>参考链接：</strong><br> <a href="https://atlas.hashicorp.com/ubuntu/boxes/trusty64" target="_blank" rel="external">first up帮助文档</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://yuqiangit.github.io/2017/02/04/elk/ELK-搭建文档/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="walter">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="五年">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/04/elk/ELK-搭建文档/" itemprop="url">ELK 搭建文档</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-04T18:20:44+08:00">
                2017-02-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ELK-搭建"><a href="#ELK-搭建" class="headerlink" title="#ELK 搭建"></a>#ELK 搭建</h2><p>[TOC]</p>
<p>##⚠️</p>
<blockquote>
<p>请保持全程elk各系统间的版本一致<br>elk的数据增长很快，请在开始的时候注意切分好index，方便清理旧数据<br>本文档仅适用于参考，不同的服务器，版本等信息均需要参看<a href="https://www.elastic.co/guide/en/beats/filebeat/5.1/filebeat-installation.html" target="_blank" rel="external">官方教程</a><br><code>一切以官网文档为第一手资料</code></p>
</blockquote>
<p>##安装：</p>
<p>###filebean</p>
<p>####下载<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-5.1.1-x86_64.rpm</div></pre></td></tr></table></figure></p>
<p>####安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rpm -vi filebeat-5.1.1-x86_64.rpm</div></pre></td></tr></table></figure></p>
<p>####配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi /etc/filebeat/filebeat.yml</div></pre></td></tr></table></figure></p>
<p>####软链<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ln <span class="_">-s</span> /etc/filebeat /data/<span class="built_in">local</span>/filebeat</div></pre></td></tr></table></figure></p>
<p>###logstash:</p>
<p>####java环境依赖<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum install java-1.8.0-openjdk</div><div class="line">yum install java-1.8.0-openjdk-devel.x86_64</div></pre></td></tr></table></figure></p>
<p><code>export JAVACMD=`which java` </code><br><code>export JAVA_HOME=`which java` </code></p>
<p>####下载<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">curl -L -O https://artifacts.elastic.co/downloads/logstash/logstash-5.1.1.rpm</div><div class="line">sudo rpm -i logstash-5.1.1.rpm</div></pre></td></tr></table></figure></p>
<p>####软链：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ln <span class="_">-s</span> /etc/logstash /data/<span class="built_in">local</span>/logstash</div></pre></td></tr></table></figure></p>
<p><code>warning: logstash-5.1.1.rpm: Header V4 RSA/SHA512 Signature, key ID d88e42b4: NOKEY</code></p>
<p>####插件：</p>
<blockquote>
<p>plugin 接收插件，gem_source 墙 <code>/usr/share/logstash/Gemfile</code></p>
<h5 id="filebeat"><a href="#filebeat" class="headerlink" title="filebeat"></a>filebeat</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/share/logstash/bin/logstash-plugin install logstash-input-beats</div></pre></td></tr></table></figure>
</blockquote>
<p>#####start bug fix<br><code>/usr/bin/filebeat.sh -e -c /data/local/filebeat/filebeat.yml</code></p>
<p>##启动</p>
<p>###filebean</p>
<p>####测试<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/share/filebeat/bin/filebeat <span class="_">-e</span> -c filebeat.yml <span class="_">-d</span> <span class="string">"publish"</span></div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/share/filebeat/bin/filebeat -e -c /data/local/filebeat/filebeat.yml -d &quot;publish&quot;</div></pre></td></tr></table></figure>
<p>####生产<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nohup /usr/bin/filebeat.sh <span class="_">-e</span> -c /data/<span class="built_in">local</span>/filebeat/filebeat.yml &amp;&gt;/dev/null &amp;</div></pre></td></tr></table></figure></p>
<p>####清空</p>
<blockquote>
<p>测试数据复用<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rm  /usr/share/filebeat/bin/data/registry</div></pre></td></tr></table></figure></p>
</blockquote>
<p>###logstash</p>
<p>####测试<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">/usr/share/logstash/bin/logstash  <span class="_">-f</span> /data/<span class="built_in">local</span>/logstash/conf.d/logstash.conf</div><div class="line">/usr/share/logstash/bin/logstash  <span class="_">-f</span> /etc/logstash/conf.d/logstash.conf</div><div class="line">bin/logstash <span class="_">-f</span> first-pipeline.conf --config.test_and_exit</div><div class="line">bin/logstash <span class="_">-f</span> first-pipeline.conf --config.reload.automatic</div></pre></td></tr></table></figure></p>
<p>####生产<br>@(工具)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nohup /usr/share/logstash/bin/logstash  <span class="_">-f</span> /data/<span class="built_in">local</span>/logstash/conf.d/logstash.conf &gt;&gt; /data/</div></pre></td></tr></table></figure></p>
<p>###elasticsearch:</p>
<p>####<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/_installation.html" target="_blank" rel="external">概览</a>：</p>
<ul>
<li>Check your cluster, node, and index health, status, and statistics</li>
<li>Administer your cluster, node, and index data and metadata</li>
<li>Perform CRUD (Create, Read, Update, and Delete) and search operations against your indexes</li>
<li>Execute advanced search operations such as paging, sorting, filtering, scripting, aggregations, and many others</li>
</ul>
<p>####下载<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"> </div><div class="line">curl -L -O https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.1.1.tar.gz</div><div class="line">tar -xvf elasticsearch-5.1.1.tar.gz</div><div class="line"><span class="built_in">cd</span> elasticsearch-5.1.1/bin</div></pre></td></tr></table></figure></p>
<p>####启动<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">./elasticsearch</div><div class="line">./elasticsearch -Ecluster.name=my_cluster_name -Enode.name=my_node_name</div></pre></td></tr></table></figure></p>
<p>####测试<br><strong>helath check</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -XGET <span class="string">'localhost:9200/_cat/health?v&amp;pretty'</span></div></pre></td></tr></table></figure></p>
<p><strong>list of node</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -XGET <span class="string">'localhost:9200/_cat/nodes?v&amp;pretty'</span></div></pre></td></tr></table></figure></p>
<p><strong>index of node  :</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -XGET <span class="string">'localhost:9200/_cat/indices?v&amp;pretty'</span></div></pre></td></tr></table></figure></p>
<p><strong>create index ：</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -XPUT <span class="string">'localhost:9200/customer?pretty&amp;pretty'</span></div></pre></td></tr></table></figure></p>
<p><strong>让我们将一个简单的客户文档索引到客户索引“外部”类型，ID为1，如下所示：</strong></p>
<blockquote>
<p>新增=修改<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">curl -XPUT <span class="string">'localhost:9200/customer/external/1?pretty&amp;pretty'</span> <span class="_">-d</span><span class="string">'</span></div><div class="line">&#123;</div><div class="line">  "name": "John Doe"</div><div class="line">&#125;'</div></pre></td></tr></table></figure></p>
<p>查看<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">curl -XGET <span class="string">'localhost:9200/customer/external/1?pretty&amp;pretty'</span></div><div class="line">curl -XGET <span class="string">'localhost:9200/customer/external/1?pretty'</span></div></pre></td></tr></table></figure></p>
<p>删除<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -XDELETE <span class="string">'localhost:9200/customer?pretty'</span></div></pre></td></tr></table></figure></p>
</blockquote>
<p><strong>del index</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -XDELETE <span class="string">'localhost:9200/customer?pretty&amp;pretty'</span></div></pre></td></tr></table></figure></p>
<p><strong>list index</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -XGET <span class="string">'localhost:9200/_cat/indices?v&amp;pretty'</span></div></pre></td></tr></table></figure></p>
<h4 id="elastic-search"><a href="#elastic-search" class="headerlink" title="elastic_search"></a>elastic_search</h4><blockquote>
<p>本轮存在很大问题啊<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">curl -XPUT <span class="string">'localhost:9200/customer?pretty'</span></div><div class="line">curl -XPUT <span class="string">'localhost:9200/customer/external/2?pretty'</span> <span class="_">-d</span><span class="string">'</span></div><div class="line">&#123;</div><div class="line">  "name": "John"</div><div class="line">&#125;'</div><div class="line">curl -XGET <span class="string">'localhost:9200/customer/external/1?pretty'</span></div><div class="line">curl -XDELETE <span class="string">'localhost:9200/customer?pretty'</span></div></pre></td></tr></table></figure></p>
</blockquote>
<p> <strong>that in the above case, we are using the POST verb instead of PUT since we didn’t specify an ID.</strong></p>
<p><strong>自增</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">curl -XPOST <span class="string">'localhost:9200/customer/external?pretty&amp;pretty'</span> <span class="_">-d</span><span class="string">'</span></div><div class="line">&#123;</div><div class="line">  "name": "Jane Doe"</div><div class="line">&#125;'</div></pre></td></tr></table></figure></p>
<p><strong>修改1</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">curl -XPOST <span class="string">'localhost:9200/customer/external/1/_update?pretty&amp;pretty'</span> <span class="_">-d</span><span class="string">'</span></div><div class="line">&#123;</div><div class="line">  "doc": &#123; "name": "Jane Doe", "age": 20 &#125;</div><div class="line">&#125;'</div></pre></td></tr></table></figure></p>
<p><strong>修改2</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">curl -XPOST <span class="string">'localhost:9200/customer/external/1/_update?pretty&amp;pretty'</span> <span class="_">-d</span><span class="string">'</span></div><div class="line">&#123;</div><div class="line">  "script" : "ctx._source.age += 5"</div><div class="line">&#125;'</div></pre></td></tr></table></figure></p>
<p>修改 put可以直接进行创建的时候修改<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -XPOST <span class="string">'localhost:9200/customer/external/1/_update?pretty&amp;pretty'</span> <span class="_">-d</span><span class="string">'</span></div></pre></td></tr></table></figure></p>
<p>####批量操作<br><code>目前测试不通过，只有批量的第一个会成功</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">curl -XPOST <span class="string">'localhost:9200/customer/external/_bulk?pretty&amp;pretty'</span> <span class="_">-d</span><span class="string">'</span></div><div class="line">&#123;"index":&#123;"_id":"1"&#125;&#125;</div><div class="line">&#123;"name": "John Doe111" &#125;</div><div class="line">&#123;"index":&#123;"_id":"2"&#125;&#125;</div><div class="line">&#123;"name": "Jane Doe222" &#125;'</div></pre></td></tr></table></figure></p>
<p>####实际数据操作<br><strong>准备数据</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">wget  https://raw.githubusercontent.com/elastic/elasticsearch/master/docs/src/<span class="built_in">test</span>/resources/accounts.json</div><div class="line">curl -XPOST <span class="string">'localhost:9200/bank/account/_bulk?pretty&amp;refresh'</span> --data-binary <span class="string">"@accounts.json"</span></div><div class="line">curl <span class="string">'localhost:9200/_cat/indices?v'</span></div></pre></td></tr></table></figure></p>
<p><strong>查询  <em>REST request URI</em> </strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -XGET <span class="string">'localhost:9200/bank/_search?q=*&amp;sort=account_number:asc&amp;pretty&amp;pretty'</span></div></pre></td></tr></table></figure></p>
<p><strong>查询  <em>REST request body</em> </strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">curl -XGET <span class="string">'localhost:9200/bank/_search?pretty'</span> <span class="_">-d</span><span class="string">'</span></div><div class="line">&#123;</div><div class="line">  "query": &#123; "match_all": &#123;&#125; &#125;,</div><div class="line">  "sort": [</div><div class="line">    &#123; "account_number": "asc" &#125;</div><div class="line">  ]</div><div class="line">&#125;'</div></pre></td></tr></table></figure></p>
<p><strong>查询扩展 <em>REST request body</em> </strong><br><code>size 默认 10</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div></pre></td><td class="code"><pre><div class="line">查询所有</div><div class="line">curl -XGET <span class="string">'localhost:9200/bank/_search?pretty'</span> <span class="_">-d</span><span class="string">'</span></div><div class="line">&#123;</div><div class="line">  "query": &#123; "match_all": &#123;&#125; &#125;</div><div class="line">&#125;'</div><div class="line">查询所有 返回1</div><div class="line">curl -XGET <span class="string">'localhost:9200/bank/_search?pretty'</span> <span class="_">-d</span><span class="string">'</span></div><div class="line">&#123;</div><div class="line">  "query": &#123; "match_all": &#123;&#125; &#125;,</div><div class="line">  "size": 1</div><div class="line">&#125;'</div><div class="line">查询所有 返回10条</div><div class="line">curl -XGET <span class="string">'localhost:9200/bank/_search?pretty'</span> <span class="_">-d</span><span class="string">'</span></div><div class="line">&#123;</div><div class="line">  "query": &#123; "match_all": &#123;&#125; &#125;,</div><div class="line">  "from": 10,</div><div class="line">  "size": 10</div><div class="line">&#125;'</div><div class="line">查询所有 返回字段仅 account_number balance</div><div class="line">curl -XGET <span class="string">'localhost:9200/bank/_search?pretty'</span> <span class="_">-d</span><span class="string">'</span></div><div class="line">&#123;</div><div class="line">  "query": &#123; "match_all": &#123;&#125; &#125;,</div><div class="line">  "_source": ["account_number", "balance"]</div><div class="line">&#125;'</div><div class="line">查询匹配 account_number = 20</div><div class="line">curl -XGET <span class="string">'localhost:9200/bank/_search?pretty'</span> <span class="_">-d</span><span class="string">'</span></div><div class="line">&#123;</div><div class="line">  "query": &#123; "match": &#123; "account_number": 20 &#125; &#125;</div><div class="line">&#125;'</div><div class="line">查询匹配 </div><div class="line">curl -XGET <span class="string">'localhost:9200/bank/_search?pretty'</span> <span class="_">-d</span><span class="string">'</span></div><div class="line">&#123;</div><div class="line">  "query": &#123; "match": &#123; "address": "mill" &#125; &#125;</div><div class="line">&#125;'</div><div class="line">查询匹配 or</div><div class="line">curl -XGET <span class="string">'localhost:9200/bank/_search?pretty'</span> <span class="_">-d</span><span class="string">'</span></div><div class="line">&#123;</div><div class="line">  "query": &#123; "match": &#123; "address": "mill lane" &#125; &#125;</div><div class="line">&#125;'</div><div class="line">查询匹配 &amp;&amp;</div><div class="line">curl -XGET <span class="string">'localhost:9200/bank/_search?pretty'</span> <span class="_">-d</span><span class="string">'</span></div><div class="line">&#123;</div><div class="line">  "query": &#123; "match_phrase": &#123; "address": "mill lane" &#125; &#125;</div><div class="line">&#125;'</div><div class="line">查询匹配 &amp;&amp;</div><div class="line">curl -XGET <span class="string">'localhost:9200/bank/_search?pretty'</span> <span class="_">-d</span><span class="string">'</span></div><div class="line">&#123;</div><div class="line">  "query": &#123;</div><div class="line">    "bool": &#123;</div><div class="line">      "must": [</div><div class="line">        &#123; "match": &#123; "address": "mill" &#125; &#125;,</div><div class="line">        &#123; "match": &#123; "address": "lane" &#125; &#125;</div><div class="line">      ]</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;'</div><div class="line">查询 ！</div><div class="line">curl -XGET <span class="string">'localhost:9200/bank/_search?pretty'</span> <span class="_">-d</span><span class="string">'</span></div><div class="line">&#123;</div><div class="line">  "query": &#123;</div><div class="line">    "bool": &#123;</div><div class="line">      "must_not": [</div><div class="line">        &#123; "match": &#123; "address": "mill" &#125; &#125;,</div><div class="line">        &#123; "match": &#123; "address": "lane" &#125; &#125;</div><div class="line">      ]</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;'</div><div class="line">组合</div><div class="line">curl -XGET <span class="string">'localhost:9200/bank/_search?pretty'</span> <span class="_">-d</span><span class="string">'</span></div><div class="line">&#123;</div><div class="line">  "query": &#123;</div><div class="line">    "bool": &#123;</div><div class="line">      "must": [</div><div class="line">        &#123; "match": &#123; "age": "40" &#125; &#125;</div><div class="line">      ],</div><div class="line">      "must_not": [</div><div class="line">        &#123; "match": &#123; "state": "ID" &#125; &#125;</div><div class="line">      ]</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;'</div><div class="line">范围</div><div class="line">curl -XGET <span class="string">'localhost:9200/bank/_search?pretty'</span> <span class="_">-d</span><span class="string">'</span></div><div class="line">&#123;</div><div class="line">  "query": &#123;</div><div class="line">    "bool": &#123;</div><div class="line">      "must": &#123; "match_all": &#123;&#125; &#125;,</div><div class="line">      "filter": &#123;</div><div class="line">        "range": &#123;</div><div class="line">          "balance": &#123;</div><div class="line">            "gte": 20000,</div><div class="line">            "lte": 30000</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;'</div><div class="line">分组查询</div><div class="line">curl -XGET <span class="string">'localhost:9200/bank/_search?pretty'</span> <span class="_">-d</span><span class="string">'</span></div><div class="line">&#123;</div><div class="line">  "size": 0,</div><div class="line">  "aggs": &#123;</div><div class="line">    "group_by_state": &#123;</div><div class="line">      "terms": &#123;</div><div class="line">        "field": "state.keyword"</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;'</div><div class="line">＝＝</div><div class="line">SELECT state, COUNT(*) FROM bank GROUP BY state ORDER BY COUNT(*) DESC</div><div class="line"></div><div class="line"></div><div class="line">curl -XGET <span class="string">'localhost:9200/bank/_search?pretty'</span> <span class="_">-d</span><span class="string">'</span></div><div class="line">&#123;</div><div class="line">  "size": 0,</div><div class="line">  "aggs": &#123;</div><div class="line">    "group_by_state": &#123;</div><div class="line">      "terms": &#123;</div><div class="line">        "field": "state.keyword",</div><div class="line">        "order": &#123;</div><div class="line">          "average_balance": "desc"</div><div class="line">        &#125;</div><div class="line">      &#125;,</div><div class="line">      "aggs": &#123;</div><div class="line">        "average_balance": &#123;</div><div class="line">          "avg": &#123;</div><div class="line">            "field": "balance"</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;'</div><div class="line"></div><div class="line"></div><div class="line">curl -XGET <span class="string">'localhost:9200/bank/_search?pretty'</span> <span class="_">-d</span><span class="string">'</span></div><div class="line">&#123;</div><div class="line">  "size": 0,</div><div class="line">  "aggs": &#123;</div><div class="line">    "group_by_state": &#123;</div><div class="line">      "terms": &#123;</div><div class="line">        "field": "state.keyword"</div><div class="line">      &#125;,</div><div class="line">      "aggs": &#123;</div><div class="line">        "average_balance": &#123;</div><div class="line">          "avg": &#123;</div><div class="line">            "field": "balance"</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;'</div><div class="line"></div><div class="line"></div><div class="line">这个例子演示了我们如何根据年龄段（20-29，30-39和40-49），然后按性别分组，然后最终得到每个年龄段的每个性别的平均帐户余额！！！</div><div class="line">curl -XGET <span class="string">'localhost:9200/bank/_search?pretty'</span> <span class="_">-d</span><span class="string">'</span></div><div class="line">&#123;</div><div class="line">  "size": 0,</div><div class="line">  "aggs": &#123;</div><div class="line">    "group_by_age": &#123;</div><div class="line">      "range": &#123;</div><div class="line">        "field": "age",</div><div class="line">        "ranges": [</div><div class="line">          &#123;</div><div class="line">            "from": 20,</div><div class="line">            "to": 30</div><div class="line">          &#125;,</div><div class="line">          &#123;</div><div class="line">            "from": 30,</div><div class="line">            "to": 40</div><div class="line">          &#125;,</div><div class="line">          &#123;</div><div class="line">            "from": 40,</div><div class="line">            "to": 50</div><div class="line">          &#125;</div><div class="line">        ]</div><div class="line">      &#125;,</div><div class="line">      "aggs": &#123;</div><div class="line">        "group_by_gender": &#123;</div><div class="line">          "terms": &#123;</div><div class="line">            "field": "gender.keyword"</div><div class="line">          &#125;,</div><div class="line">          "aggs": &#123;</div><div class="line">            "average_balance": &#123;</div><div class="line">              "avg": &#123;</div><div class="line">                "field": "balance"</div><div class="line">              &#125;</div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;'</div></pre></td></tr></table></figure></p>
<p>####elastic search 扩展练习<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">curl -XGET &apos;127.0.0.1:9200/xmpp/_search?pretty&apos; -d&apos;</div><div class="line">&#123;</div><div class="line">  &quot;query&quot;: &#123; &quot;match&quot;: &#123; &quot;message&quot;: &quot;1000010=&gt;1279133&quot; &#125; &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div></pre></td><td class="code"><pre><div class="line">GET /megacorp/employee/_search?pretty</div><div class="line"></div><div class="line">GET /megacorp/employee/_search?q=last_name:Smith</div><div class="line"></div><div class="line">GET /megacorp/employee/_search?pretty</div><div class="line">&#123;</div><div class="line">    <span class="string">"query"</span> : &#123;</div><div class="line">        <span class="string">"match"</span> : &#123;</div><div class="line">            <span class="string">"last_name"</span> : <span class="string">"Smith"</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">GET /megacorp/employee/_search?pretty</div><div class="line">&#123;</div><div class="line">    <span class="string">"query"</span> : &#123;</div><div class="line">        <span class="string">"bool"</span> : &#123;</div><div class="line">            <span class="string">"must"</span> : &#123;</div><div class="line">                <span class="string">"match"</span> : &#123;</div><div class="line">                    <span class="string">"last_name"</span> : <span class="string">"smith"</span> </div><div class="line">                &#125;</div><div class="line">            &#125;,</div><div class="line">            <span class="string">"filter"</span> : &#123;</div><div class="line">                <span class="string">"range"</span> : &#123;</div><div class="line">                    <span class="string">"age"</span> : &#123; <span class="string">"gt"</span> : 30 &#125; </div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">GET /megacorp/employee/_search</div><div class="line">&#123;</div><div class="line">    <span class="string">"query"</span> : &#123;</div><div class="line">        <span class="string">"match"</span> : &#123;</div><div class="line">            <span class="string">"about"</span> : <span class="string">"rock climbing"</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">GET /megacorp/employee/_search</div><div class="line">&#123;</div><div class="line">    <span class="string">"query"</span> : &#123;</div><div class="line">        <span class="string">"match_phrase"</span> : &#123;</div><div class="line">            <span class="string">"about"</span> : <span class="string">"rock climbing"</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">GET /megacorp/employee/_search</div><div class="line">&#123;</div><div class="line">    <span class="string">"query"</span> : &#123;</div><div class="line">        <span class="string">"match_phrase"</span> : &#123;</div><div class="line">            <span class="string">"about"</span> : <span class="string">"rock climbing"</span></div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="string">"highlight"</span>: &#123;</div><div class="line">        <span class="string">"fields"</span> : &#123;</div><div class="line">            <span class="string">"about"</span> : &#123;&#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">GET /megacorp/employee/_search</div><div class="line">&#123;</div><div class="line">  <span class="string">"aggs"</span>: &#123;</div><div class="line">    <span class="string">"all_interests"</span>: &#123;</div><div class="line">      <span class="string">"terms"</span>: &#123; <span class="string">"field"</span>: <span class="string">"interests"</span> &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">PUT /megacorp/_mapping/employee?pretty</div><div class="line">&#123;</div><div class="line">  <span class="string">"properties"</span>: &#123;</div><div class="line">    <span class="string">"interests"</span>: &#123;</div><div class="line">      <span class="string">"type"</span>:     <span class="string">"text"</span>,</div><div class="line">      <span class="string">"fielddata"</span>: <span class="literal">true</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">GET /megacorp/employee/_search</div><div class="line">&#123;</div><div class="line">  <span class="string">"query"</span>: &#123;</div><div class="line">    <span class="string">"match"</span>: &#123;</div><div class="line">      <span class="string">"last_name"</span>: <span class="string">"smith"</span></div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  <span class="string">"aggs"</span>: &#123;</div><div class="line">    <span class="string">"all_interests"</span>: &#123;</div><div class="line">      <span class="string">"terms"</span>: &#123;</div><div class="line">        <span class="string">"field"</span>: <span class="string">"interests"</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">GET /megacorp/employee/_search</div><div class="line">&#123;</div><div class="line">    <span class="string">"aggs"</span> : &#123;</div><div class="line">        <span class="string">"all_interests"</span> : &#123;</div><div class="line">            <span class="string">"terms"</span> : &#123; <span class="string">"field"</span> : <span class="string">"interests"</span> &#125;,</div><div class="line">            <span class="string">"aggs"</span> : &#123;</div><div class="line">                <span class="string">"avg_age"</span> : &#123;</div><div class="line">                    <span class="string">"avg"</span> : &#123; <span class="string">"field"</span> : <span class="string">"age"</span> &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>###kibana</p>
<p>####安装<br>vi /etc/yum.repos.d/kibana.repo<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">[kibana-5.x]</div><div class="line">name=Kibana repository for 5.x packages</div><div class="line">baseurl=https://artifacts.elastic.co/packages/5.x/yum</div><div class="line">gpgcheck=1</div><div class="line">gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch</div><div class="line">enabled=1</div><div class="line">autorefresh=1</div><div class="line">type=rpm-md</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">sudo yum install kibana</div><div class="line"></div><div class="line">sudo chkconfig --add kibana</div><div class="line">sudo -i service kibana start</div><div class="line">sudo -i service kibana stop</div></pre></td></tr></table></figure>
<p>####运行<br>sudo -i service kibana start</p>
<p>####配置<br>nginx转发<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo -i service kibana stop</div></pre></td></tr></table></figure></p>
<p>####elastic search生产环境部署bug fix：</p>
<p>#####Q1:<br><code>ERROR: bootstrap checks failed
system call filters failed to install; check the logs and fix your configuration or disable system call filters at your own risk</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">原因：</div><div class="line">这是在因为Centos6不支持SecComp，而ES5.2.0默认bootstrap.system_call_filter为true进行检测，所以导致检测失败，失败后直接导致ES不能启动。</div><div class="line"></div><div class="line">解决：</div><div class="line">在elasticsearch.yml中配置bootstrap.system_call_filter为false，注意要在Memory下面:</div><div class="line">bootstrap.memory_lock: false</div><div class="line">bootstrap.system_call_filter: false`</div></pre></td></tr></table></figure></p>
<p>#####Q2:<br><code>max file descriptors [4096] for elasticsearch process likely too low, increase to at least [65536]</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">`ulimit -n 5000`</div><div class="line"></div><div class="line">解决：切换到root用户，进入limits.d目录下修改配置文件。</div><div class="line"></div><div class="line">vi /etc/security/limits.d/90-nproc.conf </div><div class="line"></div><div class="line">修改如下内容：</div><div class="line"></div><div class="line">* soft nproc 1024</div><div class="line"></div><div class="line">#修改为</div><div class="line"></div><div class="line">* soft nproc 2048</div></pre></td></tr></table></figure></p>
<p>#####Q3<br><code>max number of threads [1024] for user [lishang] likely too low, increase to at least [2048]</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">解决：切换到root用户修改配置sysctl.conf</div><div class="line"></div><div class="line">vi /etc/sysctl.conf </div><div class="line"></div><div class="line">添加下面配置：</div><div class="line"></div><div class="line">vm.max_map_count=655360</div><div class="line"></div><div class="line">并执行命令：</div><div class="line"></div><div class="line">sysctl -p</div><div class="line"></div><div class="line">然后，重新启动elasticsearch，即可启动成功。</div></pre></td></tr></table></figure></p>
<p>###x-pack</p>
<blockquote>
<p>x-pack 是需要license的，请安装的时候注意，如果不准备申请license的话：<br>配置如下：<br><code>elasticsearch.yml</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">xpack.security.enabled: false</div><div class="line">xpack.monitoring.enabled: true</div><div class="line">xpack.graph.enabled: false</div><div class="line">#xpack.reporting.enabled: false</div></pre></td></tr></table></figure></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">some warm：</div><div class="line">Storing generated key in [/Users/langlive/Desktop/elasticsearch-5.2.1/config/x-pack/system_key]...</div><div class="line">Ensure the generated key can be read by the user that Elasticsearch runs as, permissions are set to owner read/write only</div></pre></td></tr></table></figure>
<p>####安装<br>elasticsearch<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bin/elasticsearch-plugin install x-pack</div></pre></td></tr></table></figure></p>
<p>kibana<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bin/kibana-plugin install x-pack</div></pre></td></tr></table></figure></p>
<p>logstash<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bin/logstash-plugin install x-pack</div></pre></td></tr></table></figure></p>
<p>filebeat<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim /data/local/filebeat/filebeat.yml</div></pre></td></tr></table></figure></p>
<p>####设置</p>
<p>#####密码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">curl -XPUT -u elastic &apos;127.0.0.1:9200/_xpack/security/user/elastic/_password&apos; -d &apos;&#123;</div><div class="line">  &quot;password&quot; : &quot;123456&quot;</div><div class="line">&#125;&apos;</div><div class="line"></div><div class="line">curl -XPUT -u elastic &apos;127.0.0.1:9200/_xpack/security/user/kibana/_password&apos; -d &apos;&#123;</div><div class="line">  &quot;password&quot; : &quot;123456&quot;</div><div class="line">&#125;&apos;</div><div class="line"></div><div class="line">curl -XPUT -u elastic &apos;127.0.0.1:9200/_xpack/security/user/logstash_system/_password&apos; -d &apos;&#123;</div><div class="line">  &quot;password&quot; : &quot;123456&quot;</div><div class="line">&#125;&apos;</div></pre></td></tr></table></figure></p>
<p>#####访问控制</p>
<p>######创建角色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">curl -XPOST -u elastic &apos;127.0.0.1:9200/_xpack/security/role/events_admin&apos; -d &apos;&#123;</div><div class="line">  &quot;indices&quot; : [</div><div class="line">    &#123;</div><div class="line">      &quot;names&quot; : [ &quot;events*&quot; ],</div><div class="line">      &quot;privileges&quot; : [ &quot;all&quot; ]</div><div class="line">    &#125;,</div><div class="line">	&#123;</div><div class="line">      &quot;names&quot; : [ &quot;xmpp*&quot; ],</div><div class="line">      &quot;privileges&quot; : [ &quot;all&quot; ]</div><div class="line">    &#125;,</div><div class="line">	&#123;</div><div class="line">      &quot;names&quot; : [ &quot;log*&quot; ],</div><div class="line">      &quot;privileges&quot; : [ &quot;all&quot; ]</div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">      &quot;names&quot; : [ &quot;.kibana*&quot; ],</div><div class="line">      &quot;privileges&quot; : [ &quot;manage&quot;, &quot;read&quot;, &quot;index&quot; ]</div><div class="line">    &#125;</div><div class="line">  ]</div><div class="line">&#125;&apos;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">curl -XPOST -u elastic &apos;127.0.0.1:9200/_xpack/security/role/events_root&apos; -d &apos;&#123;</div><div class="line">  &quot;cluster&quot;:all</div><div class="line">  &quot;indices&quot; : [</div><div class="line">    &#123;</div><div class="line">      &quot;names&quot; : [ &quot;*&quot; ],</div><div class="line">      &quot;privileges&quot; : [ &quot;all&quot; ]</div><div class="line">    &#125;,</div><div class="line">  ]</div><div class="line">&#125;&apos;</div></pre></td></tr></table></figure></p>
<p>######创建管理员<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">curl -XPOST -u elastic &apos;127.0.0.1:9200/_xpack/security/user/walter&apos; -d &apos;&#123;</div><div class="line">  &quot;password&quot; : &quot;enjoyprocess&quot;,</div><div class="line">  &quot;full_name&quot; : &quot;walter.shi&quot;,</div><div class="line">  &quot;email&quot; : &quot;walter.shi@langlive.com&quot;,</div><div class="line">  &quot;roles&quot; : [ &quot;events_admin&quot; ]</div><div class="line">&#125;&apos;</div><div class="line"></div><div class="line">curl -XPOST -u elastic &apos;127.0.0.1:9200/_xpack/security/user/dev&apos; -d &apos;&#123;</div><div class="line">  &quot;password&quot; : &quot;kibana-search&quot;,</div><div class="line">  &quot;full_name&quot; : &quot;langlive.dev&quot;,</div><div class="line">  &quot;email&quot; : &quot;dev@langlive.com&quot;,</div><div class="line">  &quot;roles&quot; : [ &quot;events_admin&quot; ]</div><div class="line">&#125;&apos;</div></pre></td></tr></table></figure></p>
<p>#####修改密码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">curl -XPUT &apos;localhost:9200/_xpack/security/user/elastic/_password?pretty&apos; -H &apos;Content-Type: application/json&apos; -d&apos;</div><div class="line">&#123;</div><div class="line">  &quot;password&quot;: &quot;elasticpassword&quot;</div><div class="line">&#125;</div><div class="line">&apos;</div></pre></td></tr></table></figure></p>
<p><strong>参考链接：</strong><br><a href="https://www.elastic.co/guide/en/beats/filebeat/5.1/filebeat-installation.html" target="_blank" rel="external">filebeat安装文档教程</a><br><a href="https://www.elastic.co/guide/en/beats/filebeat/current/configuration-general.html" target="_blank" rel="external">filebeat配置文档教程</a><br><a href="https://www.elastic.co/guide/en/beats/libbeat/5.1/logstash-installation.html#logstash-setup" target="_blank" rel="external">logstash安装文档教程</a><br><a href="http://www.jianshu.com/p/4fe495639a9a" target="_blank" rel="external">logstash安装插件教程</a><br><a href="https://www.elastic.co/guide/en/logstash/current/config-examples.html" target="_blank" rel="external">logstash配置文档教程</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://yuqiangit.github.io/2017/02/04/elk/ELK-配置文件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="walter">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="五年">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/04/elk/ELK-配置文件/" itemprop="url">ELK 配置文件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-04T18:20:44+08:00">
                2017-02-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ELK-配置文件"><a href="#ELK-配置文件" class="headerlink" title="#ELK 配置文件"></a>#ELK 配置文件</h2><p>[toc]</p>
<p>##配置文件</p>
<p>###nginx<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">upstream kibana5 &#123;</div><div class="line">    server localhost:5601 fail_timeout=5;</div><div class="line">    keepalive 64;</div><div class="line">&#125;</div><div class="line">server &#123;</div><div class="line">    listen               5602;</div><div class="line">    server_name          kibana_server.com;</div><div class="line">    access_log           /data/log/nginx/kibana.srv-log-dev.log;</div><div class="line">    error_log            /data/log/nginx/kibana.srv-log-dev.error.log;</div><div class="line"></div><div class="line">#    ssl                  on;</div><div class="line">#    ssl_certificate      /etc/nginx/ssl/all.crt;</div><div class="line">#    ssl_certificate_key  /etc/nginx/ssl/server.key;</div><div class="line"></div><div class="line">    location / &#123;</div><div class="line">#        root   /var/www/kibana;</div><div class="line">#        index  index.html  index.htm;</div><div class="line">         proxy_pass           http://localhost:5601;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>###文件地址</p>
<blockquote>
<p>/etc/kibana/kibana.yml<br>/data/local/elasticsearch/config/elasticsearch.yml<br>/data/local/filebeat/filebeat.yml </p>
</blockquote>
<p>###logstash.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">input &#123;</div><div class="line">  beats &#123;</div><div class="line">    port =&gt; 5044</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">filter &#123;</div><div class="line">    grok &#123;</div><div class="line">        add_field =&gt; [ &quot;received_from&quot;, &quot;%&#123;from_machine&#125;&quot; ] </div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">output &#123;</div><div class="line">    file &#123;</div><div class="line">        path           =&gt; &quot;/data/log/logstash/all.log&quot;</div><div class="line">        codec          =&gt; line &#123;format =&gt;&quot;$%&#123;from_machine&#125; %&#123;message&#125;&quot;&#125;</div><div class="line">        flush_interval =&gt; 0</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>###filebeat.yml(收集)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div></pre></td><td class="code"><pre><div class="line">###################### Filebeat Configuration Example #########################</div><div class="line"></div><div class="line"># This file is an example configuration file highlighting only the most common</div><div class="line"># options. The filebeat.full.yml file from the same directory contains all the</div><div class="line"># supported options with more comments. You can use it as a reference.</div><div class="line">#</div><div class="line"># You can find the full configuration reference here:</div><div class="line"># https://www.elastic.co/guide/en/beats/filebeat/index.html</div><div class="line"></div><div class="line">#=========================== Filebeat prospectors =============================</div><div class="line"></div><div class="line">filebeat.prospectors:</div><div class="line"></div><div class="line"># Each - is a prospector. Most options can be set at the prospector level, so</div><div class="line"># you can use different prospectors for various configurations.</div><div class="line"># Below are the prospector specific configurations.</div><div class="line"></div><div class="line">- input_type: log</div><div class="line"></div><div class="line">  # Paths that should be crawled and fetched. Glob based paths.</div><div class="line">  # 收集的日志目录</div><div class="line">  paths:</div><div class="line">    #- /var/log/*.log</div><div class="line">    #</div><div class="line">    #- c:\programdata\elasticsearch\logs\*</div><div class="line">     - /data/log/api/api.log </div><div class="line">     - /data/log/php/php.log</div><div class="line"></div><div class="line">  # Exclude lines. A list of regular expressions to match. It drops the lines that are</div><div class="line">  # matching any regular expression from the list.</div><div class="line">  #exclude_lines: [&quot;^DBG&quot;]</div><div class="line"></div><div class="line">  # Include lines. A list of regular expressions to match. It exports the lines that are</div><div class="line">  # matching any regular expression from the list.</div><div class="line">  #include_lines: [&quot;^ERR&quot;, &quot;^WARN&quot;]</div><div class="line"></div><div class="line">  # Exclude files. A list of regular expressions to match. Filebeat drops the files that</div><div class="line">  # are matching any regular expression from the list. By default, no files are dropped.</div><div class="line">  #exclude_files: [&quot;.gz$&quot;]</div><div class="line"></div><div class="line">  # Optional additional fields. These field can be freely picked</div><div class="line">  # to add additional information to the crawled log files for filtering</div><div class="line">  #fields:</div><div class="line">  #  level: debug</div><div class="line">  #  review: 1</div><div class="line"></div><div class="line">  ### Multiline options</div><div class="line"></div><div class="line">  # Mutiline can be used for log messages spanning multiple lines. This is common</div><div class="line">  # for Java Stack Traces or C-Line Continuation</div><div class="line"></div><div class="line">  # The regexp Pattern that has to be matched. The example pattern matches all lines starting with [</div><div class="line">  #multiline.pattern: ^\[</div><div class="line"></div><div class="line">  # Defines if the pattern set under pattern should be negated or not. Default is false.</div><div class="line">  #multiline.negate: false</div><div class="line"></div><div class="line">  # Match can be set to &quot;after&quot; or &quot;before&quot;. It is used to define if lines should be append to a pattern</div><div class="line">  # that was (not) matched before or after or as long as a pattern is not matched based on negate.</div><div class="line">  # Note: After is the equivalent to previous and before is the equivalent to to next in Logstash</div><div class="line">  #multiline.match: after</div><div class="line"></div><div class="line"></div><div class="line">#================================ General =====================================</div><div class="line"></div><div class="line"># The name of the shipper that publishes the network data. It can be used to group</div><div class="line"># all the transactions sent by a single shipper in the web interface.</div><div class="line">#name:</div><div class="line"></div><div class="line"># The tags of the shipper are included in their own field with each</div><div class="line"># transaction published.</div><div class="line">#tags: [&quot;service-X&quot;, &quot;web-tier&quot;]</div><div class="line"></div><div class="line"># Optional fields that you can specify to add additional information to the</div><div class="line"># output.</div><div class="line">#fields:</div><div class="line">#  env: staging</div><div class="line"></div><div class="line">#================================ Outputs =====================================</div><div class="line"></div><div class="line"># Configure what outputs to use when sending the data collected by the beat.</div><div class="line"># Multiple outputs may be used.</div><div class="line"></div><div class="line">#-------------------------- Elasticsearch output ------------------------------</div><div class="line">#output.elasticsearch:</div><div class="line">  # Array of hosts to connect to.</div><div class="line">#  hosts: [&quot;localhost:9200&quot;]</div><div class="line"></div><div class="line">  # Optional protocol and basic auth credentials.</div><div class="line">  #protocol: &quot;https&quot;</div><div class="line">  #username: &quot;elastic&quot;</div><div class="line">  #password: &quot;changeme&quot;</div><div class="line"></div><div class="line">#----------------------------- Logstash output --------------------------------</div><div class="line">#</div><div class="line">fields_under_root: true</div><div class="line">fields:</div><div class="line">  from_machine: &quot;10.8.15.106 APP[5]&quot;</div><div class="line">output.logstash:</div><div class="line">  # The Logstash hosts</div><div class="line">  hosts: [&quot;10.8.26.121:5044&quot;]</div><div class="line"></div><div class="line">  # Optional SSL. By default is off.</div><div class="line">  # List of root certificates for HTTPS server verifications</div><div class="line">  #ssl.certificate_authorities: [&quot;/etc/pki/root/ca.pem&quot;]</div><div class="line"></div><div class="line">  # Certificate for SSL client authentication</div><div class="line">  #ssl.certificate: &quot;/etc/pki/client/cert.pem&quot;</div><div class="line"></div><div class="line">  # Client Certificate Key</div><div class="line">  #ssl.key: &quot;/etc/pki/client/cert.key&quot;</div><div class="line"></div><div class="line">#================================ Logging =====================================</div><div class="line"></div><div class="line"># Sets log level. The default log level is info.</div><div class="line"># Available log levels are: critical, error, warning, info, debug</div><div class="line">#logging.level: debug</div><div class="line"></div><div class="line"># At debug level, you can selectively enable logging only for some components.</div><div class="line"># To enable all selectors use [&quot;*&quot;]. Examples of other selectors are &quot;beat&quot;,</div><div class="line"># &quot;publish&quot;, &quot;service&quot;.</div><div class="line">#logging.selectors: [&quot;*&quot;]</div></pre></td></tr></table></figure></p>
<p>###filebeat.yml (加密)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">###################### Filebeat Configuration Example #########################</div><div class="line"></div><div class="line"># This file is an example configuration file highlighting only the most common</div><div class="line"># options. The filebeat.full.yml file from the same directory contains all the</div><div class="line"># supported options with more comments. You can use it as a reference.</div><div class="line">#</div><div class="line"># You can find the full configuration reference here:</div><div class="line"># https://www.elastic.co/guide/en/beats/filebeat/index.html</div><div class="line"></div><div class="line">#=========================== Filebeat prospectors =============================</div><div class="line"></div><div class="line">filebeat.prospectors:</div><div class="line"></div><div class="line"># Each - is a prospector. Most options can be set at the prospector level, so</div><div class="line"># you can use different prospectors for various configurations.</div><div class="line"># Below are the prospector specific configurations.</div><div class="line"></div><div class="line">- input_type: log</div><div class="line"></div><div class="line">  # Paths that should be crawled and fetched. Glob based paths.</div><div class="line">  paths:</div><div class="line">    - /data/log/lang-xmpp/api.log</div><div class="line">    #- /var/log/*.log</div><div class="line">    #- c:\programdata\elasticsearch\logs\*</div><div class="line"></div><div class="line">  # Exclude lines. A list of regular expressions to match. It drops the lines that are</div><div class="line">  # matching any regular expression from the list.</div><div class="line">  #exclude_lines: [&quot;^DBG&quot;]</div><div class="line"></div><div class="line">  # Include lines. A list of regular expressions to match. It exports the lines that are</div><div class="line">  # matching any regular expression from the list.</div><div class="line">  #include_lines: [&quot;^ERR&quot;, &quot;^WARN&quot;]</div><div class="line"></div><div class="line">  # Exclude files. A list of regular expressions to match. Filebeat drops the files that</div><div class="line">  # are matching any regular expression from the list. By default, no files are dropped.</div><div class="line">  #exclude_files: [&quot;.gz$&quot;]</div><div class="line"></div><div class="line">  # Optional additional fields. These field can be freely picked</div><div class="line">  # to add additional information to the crawled log files for filtering</div><div class="line">  #fields:</div><div class="line">  #  level: debug</div><div class="line">  #  review: 1</div><div class="line"></div><div class="line">  ### Multiline options</div><div class="line"></div><div class="line">  # Mutiline can be used for log messages spanning multiple lines. This is common</div><div class="line">  # for Java Stack Traces or C-Line Continuation</div><div class="line"></div><div class="line">  # The regexp Pattern that has to be matched. The example pattern matches all lines starting with [</div><div class="line">  #multiline.pattern: ^\[</div><div class="line"></div><div class="line">  # Defines if the pattern set under pattern should be negated or not. Default is false.</div><div class="line">  #multiline.negate: false</div><div class="line"></div><div class="line">  # Match can be set to &quot;after&quot; or &quot;before&quot;. It is used to define if lines should be append to a pattern</div><div class="line">  # that was (not) matched before or after or as long as a pattern is not matched based on negate.</div><div class="line">  # Note: After is the equivalent to previous and before is the equivalent to to next in Logstash</div><div class="line">  #multiline.match: after</div><div class="line"></div><div class="line"></div><div class="line">#================================ General =====================================</div><div class="line">fields_under_root: true</div><div class="line">#fields:</div><div class="line">#  from_machine: &quot;10.8.17.112 APP[1]&quot;</div><div class="line"># The name of the shipper that publishes the network data. It can be used to group</div><div class="line"># all the transactions sent by a single shipper in the web interface.</div><div class="line">#name:</div><div class="line"></div><div class="line"># The tags of the shipper are included in their own field with each</div><div class="line"># transaction published.</div><div class="line">#tags: [&quot;service-X&quot;, &quot;web-tier&quot;]</div><div class="line"></div><div class="line"># Optional fields that you can specify to add additional information to the</div><div class="line"># output.</div><div class="line">#fields:</div><div class="line">#  env: staging</div><div class="line"></div><div class="line">#================================ Outputs =====================================</div><div class="line"></div><div class="line"># Configure what outputs to use when sending the data collected by the beat.</div><div class="line"># Multiple outputs may be used.</div><div class="line"></div><div class="line">#-------------------------- Elasticsearch output ------------------------------</div><div class="line">output.elasticsearch:</div><div class="line">  # Array of hosts to connect to.</div><div class="line">  hosts: [&quot;10.8.17.112:9200&quot;]</div><div class="line">  index: &quot;xmpp-%&#123;+yyyy.MM.dd&#125;&quot;</div><div class="line">  # Optional protocol and basic auth credentials.</div><div class="line">  #protocol: &quot;https&quot;</div><div class="line">  username: &quot;elastic&quot;</div><div class="line">  password: &quot;elasticpassword0314&quot;</div><div class="line"></div><div class="line">#----------------------------- Logstash output --------------------------------</div><div class="line">#output.logstash:</div><div class="line">#  hosts: [&quot;10.8.26.121:5044&quot;]</div><div class="line"></div><div class="line">  # Optional SSL. By default is off.</div><div class="line">  # List of root certificates for HTTPS server verifications</div><div class="line">  #ssl.certificate_authorities: [&quot;/etc/pki/root/ca.pem&quot;]</div><div class="line"></div><div class="line">  # Certificate for SSL client authentication</div><div class="line">  #ssl.certificate: &quot;/etc/pki/client/cert.pem&quot;</div><div class="line"></div><div class="line">  # Client Certificate Key</div><div class="line">  #ssl.key: &quot;/etc/pki/client/cert.key&quot;</div><div class="line"></div><div class="line">#================================ Logging =====================================</div><div class="line"></div><div class="line"># Sets log level. The default log level is info.</div><div class="line"># Available log levels are: critical, error, warning, info, debug</div><div class="line">#logging.level: debug</div><div class="line"></div><div class="line"># At debug level, you can selectively enable logging only for some components.</div><div class="line"># To enable all selectors use [&quot;*&quot;]. Examples of other selectors are &quot;beat&quot;,</div><div class="line"># &quot;publish&quot;, &quot;service&quot;.</div><div class="line">#logging.selectors: [&quot;*&quot;]</div><div class="line">~                                                                                                                                                                                                                                                                                                                                                                        </div><div class="line">~</div></pre></td></tr></table></figure>
<p>###elasticsearch<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"># ======================== Elasticsearch Configuration =========================</div><div class="line">#</div><div class="line"># NOTE: Elasticsearch comes with reasonable defaults for most settings.</div><div class="line">#       Before you set out to tweak and tune the configuration, make sure you</div><div class="line">#       understand what are you trying to accomplish and the consequences.</div><div class="line">#</div><div class="line"># The primary way of configuring a node is via this file. This template lists</div><div class="line"># the most important settings you may want to configure for a production cluster.</div><div class="line">#</div><div class="line"># Please consult the documentation for further information on configuration options:</div><div class="line"># https://www.elastic.co/guide/en/elasticsearch/reference/index.html</div><div class="line">#</div><div class="line"># ---------------------------------- Cluster -----------------------------------</div><div class="line">#</div><div class="line"># Use a descriptive name for your cluster:</div><div class="line">#</div><div class="line">#cluster.name: my-application</div><div class="line">#</div><div class="line"># ------------------------------------ Node ------------------------------------</div><div class="line">#</div><div class="line"># Use a descriptive name for the node:</div><div class="line">#</div><div class="line">#node.name: node-1</div><div class="line">#</div><div class="line"># Add custom attributes to the node:</div><div class="line">#</div><div class="line">#node.attr.rack: r1</div><div class="line">#</div><div class="line"># ----------------------------------- Paths ------------------------------------</div><div class="line">#</div><div class="line"># Path to directory where to store the data (separate multiple locations by comma):</div><div class="line">#</div><div class="line">#path.data: /path/to/data</div><div class="line">#</div><div class="line"># Path to log files:</div><div class="line">#</div><div class="line">#path.logs: /path/to/logs</div><div class="line">#</div><div class="line"># ----------------------------------- Memory -----------------------------------</div><div class="line">#</div><div class="line"># Lock the memory on startup:</div><div class="line">#</div><div class="line">#bootstrap.memory_lock: true</div><div class="line">bootstrap.memory_lock: false</div><div class="line">bootstrap.system_call_filter: false</div><div class="line">#</div><div class="line"># Make sure that the heap size is set to about half the memory available</div><div class="line"># on the system and that the owner of the process is allowed to use this</div><div class="line"># limit.</div><div class="line">#</div><div class="line"># Elasticsearch performs poorly when the system is swapping the memory.</div><div class="line">#</div><div class="line"># ---------------------------------- Network -----------------------------------</div><div class="line">#</div><div class="line"># Set the bind address to a specific IP (IPv4 or IPv6):</div><div class="line">#</div><div class="line">network.host: 10.8.17.112</div><div class="line">#</div><div class="line"># Set a custom port for HTTP:</div><div class="line">#</div><div class="line">http.port: 9200</div><div class="line">#</div><div class="line"># For more information, consult the network module documentation.</div><div class="line">#</div><div class="line"># --------------------------------- Discovery ----------------------------------</div><div class="line">#</div><div class="line"># Pass an initial list of hosts to perform discovery when new node is started:</div><div class="line"># The default list of hosts is [&quot;127.0.0.1&quot;, &quot;[::1]&quot;]</div><div class="line">#</div><div class="line">#discovery.zen.ping.unicast.hosts: [&quot;host1&quot;, &quot;host2&quot;]</div><div class="line">#</div><div class="line"># Prevent the &quot;split brain&quot; by configuring the majority of nodes (total number of master-eligible nodes / 2 + 1):</div><div class="line">#</div><div class="line">#discovery.zen.minimum_master_nodes: 3</div><div class="line">#</div><div class="line"># For more information, consult the zen discovery module documentation.</div><div class="line">#</div><div class="line"># ---------------------------------- Gateway -----------------------------------</div><div class="line">#</div><div class="line"># Block initial recovery after a full cluster restart until N nodes are started:</div><div class="line">#</div><div class="line">#gateway.recover_after_nodes: 3</div><div class="line">#</div><div class="line"># For more information, consult the gateway module documentation.</div><div class="line">#</div><div class="line"># ---------------------------------- Various -----------------------------------</div><div class="line">#</div><div class="line"># Require explicit names when deleting indices:</div><div class="line">#</div><div class="line">#action.destructive_requires_name: true</div><div class="line"></div><div class="line">action.auto_create_index: .security,.monitoring*,.watches,.triggered_watches,.watcher-history*</div><div class="line"></div><div class="line">xpack.security.audit.enabled: true</div></pre></td></tr></table></figure></p>
<p>###kibana.yml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Kibana is served by a back end server. This setting specifies the port to use.</div><div class="line">server.port: 5601</div><div class="line"></div><div class="line"># Specifies the address to which the Kibana server will bind. IP addresses and host names are both valid values.</div><div class="line"># The default is &apos;localhost&apos;, which usually means remote machines will not be able to connect.</div><div class="line"># To allow connections from remote users, set this parameter to a non-loopback address.</div><div class="line">server.host: &quot;localhost&quot;</div><div class="line"></div><div class="line"># Enables you to specify a path to mount Kibana at if you are running behind a proxy. This only affects</div><div class="line"># the URLs generated by Kibana, your proxy is expected to remove the basePath value before forwarding requests</div><div class="line"># to Kibana. This setting cannot end in a slash.</div><div class="line">#server.basePath: &quot;&quot;</div><div class="line"></div><div class="line"># The maximum payload size in bytes for incoming server requests.</div><div class="line">#server.maxPayloadBytes: 1048576</div><div class="line"></div><div class="line"># The Kibana server&apos;s name.  This is used for display purposes.</div><div class="line">#server.name: &quot;your-hostname&quot;</div><div class="line"></div><div class="line"># The URL of the Elasticsearch instance to use for all your queries.</div><div class="line">elasticsearch.url: &quot;http://10.8.17.112:9200&quot;</div><div class="line"></div><div class="line"># When this setting&apos;s value is true Kibana uses the hostname specified in the server.host</div><div class="line"># setting. When the value of this setting is false, Kibana uses the hostname of the host</div><div class="line"># that connects to this Kibana instance.</div><div class="line">#elasticsearch.preserveHost: true</div><div class="line"></div><div class="line"># Kibana uses an index in Elasticsearch to store saved searches, visualizations and</div><div class="line"># dashboards. Kibana creates a new index if the index doesn&apos;t already exist.</div><div class="line">kibana.index: &quot;.kibana&quot;</div><div class="line"></div><div class="line"># The default application to load.</div><div class="line">#kibana.defaultAppId: &quot;discover&quot;</div><div class="line"></div><div class="line"># If your Elasticsearch is protected with basic authentication, these settings provide</div><div class="line"># the username and password that the Kibana server uses to perform maintenance on the Kibana</div><div class="line"># index at startup. Your Kibana users still need to authenticate with Elasticsearch, which</div><div class="line"># is proxied through the Kibana server.</div><div class="line">elasticsearch.username: &quot;kibana&quot;</div><div class="line">elasticsearch.password: &quot;kibanapassword0314&quot;</div><div class="line"></div><div class="line"># Paths to the PEM-format SSL certificate and SSL key files, respectively. These</div><div class="line"># files enable SSL for outgoing requests from the Kibana server to the browser.</div><div class="line">#server.ssl.cert: /path/to/your/server.crt</div><div class="line">#server.ssl.key: /path/to/your/server.key</div><div class="line"></div><div class="line"># Optional settings that provide the paths to the PEM-format SSL certificate and key files.</div><div class="line"># These files validate that your Elasticsearch backend uses the same key files.</div><div class="line">#elasticsearch.ssl.cert: /path/to/your/client.crt</div><div class="line">#elasticsearch.ssl.key: /path/to/your/client.key</div><div class="line"></div><div class="line"># Optional setting that enables you to specify a path to the PEM file for the certificate</div><div class="line"># authority for your Elasticsearch instance.</div><div class="line">#elasticsearch.ssl.ca: /path/to/your/CA.pem</div><div class="line"></div><div class="line"># To disregard the validity of SSL certificates, change this setting&apos;s value to false.</div><div class="line">#elasticsearch.ssl.verify: true</div><div class="line"></div><div class="line"># Time in milliseconds to wait for Elasticsearch to respond to pings. Defaults to the value of</div><div class="line"># the elasticsearch.requestTimeout setting.</div><div class="line">#elasticsearch.pingTimeout: 1500</div><div class="line"></div><div class="line"># Time in milliseconds to wait for responses from the back end or Elasticsearch. This value</div><div class="line"># must be a positive integer.</div><div class="line">#elasticsearch.requestTimeout: 30000</div><div class="line"></div><div class="line"># List of Kibana client-side headers to send to Elasticsearch. To send *no* client-side</div><div class="line"># headers, set this value to [] (an empty list).</div><div class="line">#elasticsearch.requestHeadersWhitelist: [ authorization ]</div><div class="line"></div><div class="line"># Header names and values that are sent to Elasticsearch. Any custom headers cannot be overwritten</div><div class="line"># by client-side headers, regardless of the elasticsearch.requestHeadersWhitelist configuration.</div><div class="line">#elasticsearch.customHeaders: &#123;&#125;</div><div class="line"></div><div class="line"># Time in milliseconds for Elasticsearch to wait for responses from shards. Set to 0 to disable.</div><div class="line">#elasticsearch.shardTimeout: 0</div><div class="line"></div><div class="line"># Time in milliseconds to wait for Elasticsearch at Kibana startup before retrying.</div><div class="line">#elasticsearch.startupTimeout: 5000</div><div class="line"></div><div class="line"># Specifies the path where Kibana creates the process ID file.</div><div class="line">#pid.file: /var/run/kibana.pid</div><div class="line"></div><div class="line"># Enables you specify a file where Kibana stores log output.</div><div class="line">#logging.dest: stdout</div><div class="line"></div><div class="line"># Set the value of this setting to true to suppress all logging output.</div><div class="line">#logging.silent: false</div><div class="line"></div><div class="line"># Set the value of this setting to true to suppress all logging output other than error messages.</div><div class="line">#logging.quiet: false</div><div class="line"></div><div class="line"># Set the value of this setting to true to log all events, including system usage information</div><div class="line"># and all requests.</div><div class="line">#logging.verbose: false</div><div class="line"></div><div class="line"># Set the interval in milliseconds to sample system and process performance</div><div class="line"># metrics. Minimum is 100ms. Defaults to 5000.</div><div class="line">#ops.interval: 5000</div><div class="line">#</div><div class="line">xpack.security.enabled: true</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://yuqiangit.github.io/2017/02/04/nginx/nginx500错误/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="walter">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="五年">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/04/nginx/nginx500错误/" itemprop="url">异常处理（持续更新...）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-04T18:20:44+08:00">
                2017-02-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#nginx 500 解决方案汇总</p>
<p>[toc]</p>
<p>##检查php-fpm 进程</p>
<blockquote>
<p>原因：脚本执行时间超时，导致php-fpm进程被占用<br>方案：<br>临时：添加php-fpm进程数<br>步骤：<br>1，ps -ef | grep php-fpm 查看当前php-fpm的配置文件<br>2，pm = static &amp;&amp; pm.max_children = 128</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://yuqiangit.github.io/2017/02/04/liunx/linux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="walter">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="五年">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/04/liunx/linux/" itemprop="url">linux</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-04T18:20:44+08:00">
                2017-02-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="linux"><a href="#linux" class="headerlink" title="#linux"></a>#linux</h2><p>[TOC]</p>
<p>##系统</p>
<table>
<thead>
<tr>
<th>信息</th>
<th>命令</th>
</tr>
</thead>
<tbody>
<tr>
<td>内核/操作系统/CPU信息</td>
<td><code>uname</code></td>
</tr>
<tr>
<td>操作系统版本</td>
<td>head -n 1 /etc/issue</td>
</tr>
<tr>
<td>计算机名</td>
<td>hostname</td>
</tr>
<tr>
<td>列出加载的内核模块</td>
<td>lsmod</td>
</tr>
<tr>
<td>查看环境变量</td>
<td>env</td>
</tr>
<tr>
<td>查看系统</td>
<td>ps -p 1</td>
</tr>
</tbody>
</table>
<p>##资源</p>
<table>
<thead>
<tr>
<th>信息</th>
<th>命令</th>
</tr>
</thead>
<tbody>
<tr>
<td>查看内存使用量和交换区使用量</td>
<td><code>free -g</code></td>
</tr>
<tr>
<td>查看系统运行时间、用户数、负载</td>
<td>uptime</td>
</tr>
<tr>
<td>端口zan yong</td>
<td>lsof -i</td>
<td>grep 5601</td>
</tr>
<tr>
<td>查看硬盘</td>
<td><code>du -sh *</code> ``</td>
</tr>
</tbody>
</table>
<p>##用户</p>
<table>
<thead>
<tr>
<th>信息</th>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>新增</td>
<td><code>adduser</code></td>
<td>会自动为创建的用户指定主目录、系统shell版本，会在创建时输入用户密码。</td>
</tr>
<tr>
<td>新增</td>
<td><code>useradd</code></td>
<td>需要使用参数选项指定上述基本设置，如果不使用任何参数，则创建的用户无密码、无主目录、没有指定shell版本</td>
</tr>
<tr>
<td>添加root</td>
<td></td>
<td><code>vi /etc/sudoers.d/$user &amp;&amp; $user ALL=(ALL) ALL``chmod $user_file 400</code></td>
</tr>
<tr>
<td>修改密码</td>
<td><code>sudo passwd $suser</code></td>
</tr>
<tr>
<td>修改用户权限</td>
<td><code>sudo chown -R elasticsearch:elasticsearch /data/local/elasticsearch</code></td>
</tr>
</tbody>
</table>
<p>##进程<br>|信息|命令|描述<br>|:|<br>|kill|<code>ps -ef | grep xmpp.php | grep -v grep | awk &#39;{print $2}&#39; | xargs kill</code>|</p>
<p>##文件</p>
<table>
<thead>
<tr>
<th>信息</th>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>软链</td>
<td><code>ln -s /data/local/mysql5.6.16/bin/mysql /uer/bin</code></td>
</tr>
</tbody>
</table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">系统</div><div class="line"></div><div class="line">　　# uname -a # 查看内核/操作系统/CPU信息</div><div class="line">　　# head -n 1 /etc/issue # 查看操作系统版本</div><div class="line">　　# cat /proc/cpuinfo # 查看CPU信息</div><div class="line">　　# hostname # 查看计算机名</div><div class="line">　　# lspci -tv # 列出所有PCI设备</div><div class="line">　　# lsusb -tv # 列出所有USB设备</div><div class="line">　　# lsmod # 列出加载的内核模块</div><div class="line">　　# env # 查看环境变量</div><div class="line"></div><div class="line">资源</div><div class="line"></div><div class="line">　　# free -m # 查看内存使用量和交换区使用量</div><div class="line">　　# df -h # 查看各分区使用情况</div><div class="line">　　# du -sh &lt;目录名&gt; # 查看指定目录的大小</div><div class="line">　　# grep MemTotal /proc/meminfo # 查看内存总量</div><div class="line">　　# grep MemFree /proc/meminfo # 查看空闲内存量</div><div class="line">　　# uptime # 查看系统运行时间、用户数、负载</div><div class="line">　　# cat /proc/loadavg # 查看系统负载</div><div class="line"></div><div class="line">磁盘和分区</div><div class="line"></div><div class="line">　　# mount | column -t # 查看挂接的分区状态</div><div class="line">　　# fdisk -l # 查看所有分区</div><div class="line">　　# swapon -s # 查看所有交换分区</div><div class="line">　　# hdparm -i /dev/hda # 查看磁盘参数（仅适用于IDE设备）</div><div class="line">　　# dmesg | grep IDE # 查看启动时IDE设备检测状况</div><div class="line"></div><div class="line">网络</div><div class="line"></div><div class="line">　　# ifconfig # 查看所有网络接口的属性</div><div class="line">　　# iptables -L # 查看防火墙设置</div><div class="line">　　# route -n # 查看路由表</div><div class="line">　　# netstat -lntp # 查看所有监听端口</div><div class="line">　　# netstat -antp # 查看所有已经建立的连接</div><div class="line">　　# netstat -s # 查看网络统计信息</div><div class="line"></div><div class="line">进程</div><div class="line"></div><div class="line">　　# ps -ef # 查看所有进程</div><div class="line">　　# top # 实时显示进程状态</div><div class="line"></div><div class="line">用户</div><div class="line"></div><div class="line">　　# w # 查看活动用户</div><div class="line">　　# id &lt;用户名&gt; # 查看指定用户信息</div><div class="line">　　# last # 查看用户登录日志</div><div class="line">　　# cut -d: -f1 /etc/passwd # 查看系统所有用户</div><div class="line">　　# cut -d: -f1 /etc/group # 查看系统所有组</div><div class="line">　　# crontab -l # 查看当前用户的计划任务</div><div class="line"></div><div class="line">服务</div><div class="line"></div><div class="line">　　# chkconfig --list # 列出所有系统服务</div><div class="line">　　# chkconfig --list | grep on # 列出所有启动的系统服务</div><div class="line"></div><div class="line">程序</div><div class="line"></div><div class="line">　　# rpm -qa # 查看所有安装的软件包</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://yuqiangit.github.io/2017/02/04/nginx/auth_basic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="walter">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="五年">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/04/nginx/auth_basic/" itemprop="url">auth_basic</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-04T18:20:44+08:00">
                2017-02-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#nginx auth_basic 配置</p>
<p>nginx .conf 文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">upstream kibana5 &#123;</div><div class="line">    server localhost:5601 fail_timeout=5;</div><div class="line">    keepalive 64;</div><div class="line">&#125;</div><div class="line">server &#123;</div><div class="line">    listen               5602;</div><div class="line">    server_name          kibana_server.com;</div><div class="line">    access_log           /data/log/nginx/kibana.srv-log-dev.log;</div><div class="line">    error_log            /data/log/nginx/kibana.srv-log-dev.error.log;</div><div class="line"></div><div class="line">    location / &#123;</div><div class="line">         auth_basic &quot;secret&quot;;</div><div class="line">         auth_basic_user_file /data/local/nginx/passwd.db;</div><div class="line">         proxy_pass           http://localhost:5601;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><em>配置的选项</em><br><code>auth_basic &quot;secret&quot;;
 auth_basic_user_file /data/local/nginx/passwd.db;</code></p>
<p><em>auth文件</em><br>/data/local/nginx/passwd.db</p>
<p>我使用的是nginx服务器：为了方便直接使用在线工具生成的，格式如下：<br>user:passwd</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="walter" />
          <p class="site-author-name" itemprop="name">walter</p>
           
              <p class="site-description motion-element" itemprop="description">技术博客</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">walter</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

</body>
</html>
